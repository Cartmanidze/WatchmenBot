# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/).

## [Unreleased]

### Added

- **E2E test for bot-directed questions** ‚Äî –Ω–æ–≤—ã–π —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ hybrid search –∏ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –±–æ—Ç–µ:
  - **–¢–µ—Å—Ç**: `HandleAsync_BotDirectedQuestions_ReturnsRelevantAnswers`
  - **–°—Ü–µ–Ω–∞—Ä–∏–π**:
    1. Seed —Å–æ–æ–±—â–µ–Ω–∏–µ: "—Ç—ã —Å–æ–∑–¥–∞–Ω —á—Ç–æ–±—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–∞–º—ã–µ —Ç—É–ø—ã–µ –≤–æ–ø—Ä–æ—Å—ã –æ—Ç –º–µ–Ω—è"
    2. –í–æ–ø—Ä–æ—Å 1: "–¥–ª—è —á–µ–≥–æ —Ç—ã —Å–æ–∑–¥–∞–Ω?" ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –æ—Ç–≤–µ—Ç–∞ —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
    3. –í–æ–ø—Ä–æ—Å 2: "—Ç—ã —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω –∏–∑-–∑–∞ —Å–≤–æ–µ–π –≥–ª—É–ø–æ–π —Ü–µ–ª–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è?" ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
  - **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è**:
    - Hybrid Search (Vector + Keywords) ‚Äî bot-directed –≤–æ–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç keyword matching –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ "–±–æ—Ç", "—Å–æ–∑–¥–∞–Ω"
    - Q‚ÜíA transformation ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –≤–∞—Ä–∏–∞—Ü–∏–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç –≤–æ–ø—Ä–æ—Å "–¥–ª—è —á–µ–≥–æ —Ç—ã —Å–æ–∑–¥–∞–Ω?" –≤ –ø–∞—Ç—Ç–µ—Ä–Ω –æ—Ç–≤–µ—Ç–∞ "—Ç—ã —Å–æ–∑–¥–∞–Ω —á—Ç–æ–±—ã..."
    - –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –±–æ—Ç–∞ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Å–ª–æ–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –æ —Å–≤–æ–µ–π —Ü–µ–ª–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
  - **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**:
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ Jina API embeddings –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
    - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ ("—Å–æ–∑–¥–∞", "–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞", "–≤–æ–ø—Ä–æ—Å", "—Ü–µ–ª—å") –≤ –æ—Ç–≤–µ—Ç–∞—Ö
    - –û–±–∞ –≤–æ–ø—Ä–æ—Å–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤ –æ–¥–Ω–æ–º —Ç–µ—Å—Ç–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏
    - **–ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** ‚Äî `[Fact(Skip = "Requires API keys")]` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ CI (~5 —Å–µ–∫ –≤–º–µ—Å—Ç–æ ~33 —Å–µ–∫)
  - **–†–µ–∑—É–ª—å—Ç–∞—Ç** ‚Äî –æ–±–∞ –≤–æ–ø—Ä–æ—Å–∞ –ø–æ–ª—É—á–∞—é—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (Success=True, Confidence=Low) –∑–∞ ~20 —Å–µ–∫—É–Ω–¥
  - **–§–∞–π–ª—ã** ‚Äî `AskHandlerE2ETests.cs:519-663`, `SeedBotPurposeDataAsync():605-663`

### Fixed

- **E2E tests for /ask command** ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ background processing:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî —Ç–µ—Å—Ç `HandleAsync_PersonalQuestion_ReturnsAnswer` –ø–∞–¥–∞–ª –∏–∑-–∑–∞:
    - –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ —Ç–∞–±–ª–∏—Ü–∞ `user_aliases` –≤ DatabaseFixture
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å —Ñ–µ–π–∫–æ–≤—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ `[0.1, 0.1, ...]` ‚Üí Confidence=None
    - –í–æ–ø—Ä–æ—Å "—á—Ç–æ —è –≥–æ–≤–æ—Ä–∏–ª –ø—Ä–æ —Ä–∞–±–æ—Ç—É?" –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ —Ç–µ—Å—Ç–æ–≤—ã–º –¥–∞–Ω–Ω—ã–º
  - **–†–µ—à–µ–Ω–∏–µ**:
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `user_aliases` –≤ `DatabaseFixture.InitializeDatabaseSchemaAsync()`
    - –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ Jina API embeddings –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
    - –ò–∑–º–µ–Ω—ë–Ω –≤–æ–ø—Ä–æ—Å –Ω–∞ "–∫–∞–∫–∏–µ —è–∑—ã–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —è –∏—Å–ø–æ–ª—å–∑—É—é?" ‚Äî –ª—É—á—à–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç "–û–±–æ–∂–∞—é Python –∏ TypeScript"
    - –£–ø—Ä–æ—â–µ–Ω—ã assertions: –ø—Ä–æ–≤–µ—Ä—è–µ–º `ResponseSent` –∏ –Ω–∞–ª–∏—á–∏–µ —Ç–µ–∫—Å—Ç–∞ –æ—Ç–≤–µ—Ç–∞
    - –î–æ–±–∞–≤–ª–µ–Ω seeding `user_aliases` —Å username, display_name –¥–ª—è nickname resolution
  - **–†–µ–∑—É–ª—å—Ç–∞—Ç** ‚Äî —Ç–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ —Å `Success=true` –∑–∞ ~6 —Å–µ–∫—É–Ω–¥
  - **–§–∞–π–ª—ã** ‚Äî `DatabaseFixture.cs`, `AskHandlerE2ETests.cs`

### Changed

- **Default embeddings provider changed from HuggingFace to Jina AI** ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Jina –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ RAG:
  - **–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å**:
    - `appsettings.json`: Provider –∏–∑–º–µ–Ω—ë–Ω —Å `huggingface` ‚Üí `jina`
    - –ú–æ–¥–µ–ª—å: `deepvk/USER-bge-m3` ‚Üí `jina-embeddings-v3`
    - API: HuggingFace Inference ‚Üí Jina AI (https://api.jina.ai/v1)
    - `TestConfiguration.cs`: —Ç–µ–ø–µ—Ä—å —á–∏—Ç–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥ –∏–∑ `Llm:Providers:0:*` –≤–º–µ—Å—Ç–æ `OpenRouter:*`
  - **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Jina**:
    - **Late Chunking** ‚Äî —É–ª—É—á—à–µ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏ (+10-15% —Ç–æ—á–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞)
    - **Task-specific embeddings** ‚Äî —Ä–∞–∑–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è query vs passage
    - **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** ‚Äî –Ω–µ—Ç cold starts –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç HuggingFace serverless
    - **–¶–µ–Ω–∞** ‚Äî $0.00002/1K tokens (–∫–∞–∫ OpenAI, –Ω–æ —Å late chunking)
  - **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**:
    - HuggingFace –≤—Å—ë –µ—â—ë –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è (–º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ config)
    - OpenAI —Ç–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–µ–Ω –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
    - –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –≤–µ–∫—Ç–æ—Ä–æ–≤ –æ—Å—Ç–∞–ª–∞—Å—å 1024 (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î)
  - **E2E —Ç–µ—Å—Ç—ã**:
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–∏—Ç–∞—é—Ç –∫–ª—é—á–∏ –∏–∑ `appsettings.Development.json`
    - OpenRouter: `Llm:Providers:0:ApiKey`
    - Jina: `Embeddings:ApiKey`
    - –ù–∏–∫–∞–∫–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
    - –ò—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ API –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  - **–§–∞–π–ª—ã** ‚Äî `appsettings.json`, `appsettings.Development.json`, `TestConfiguration.cs`
  - **Production** ‚Äî —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Jina —Å 2025-01-06 (155K+ –≤–µ–∫—Ç–æ—Ä–æ–≤)

### Removed

- **HyDE (Hypothetical Document Embeddings) removed from RAG Fusion** ‚Äî —É–¥–∞–ª—ë–Ω –∏–∑ –ø–æ–∏—Å–∫–∞ –ø–æ —á–∞—Ç–∞–º:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî HyDE –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —á–∞—Ç–æ–≤:
    - HyDE —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è —Ñ–æ—Ä–º–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –Ω–µ –¥–ª—è —á–∞—Ç–æ–≤
    - –ß–∞—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–ª–µ–Ω–≥, –º–µ–º—ã, –∫–æ—Ä–æ—Ç–∫–∏–µ —Ñ—Ä–∞–∑—ã –±–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
    - HyDE –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç "–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ" –æ—Ç–≤–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º
    - –ü—Ä–∏–º–µ—Ä: –Ω–∞ –≤–æ–ø—Ä–æ—Å "–∫—Ç–æ —Å–æ—Å—É–Ω?" HyDE –≤–æ–æ–±—Ä–∞–∂–∞–µ—Ç "–Ω—É —ç—Ç–æ –í–∞—Å—è, –æ–Ω –≤—á–µ—Ä–∞ –ø—Ä–æ–∏–≥—Ä–∞–ª", –∞ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å ‚Äî –ø—Ä–æ—Å—Ç–æ "–±–µ–∫ —Å–æ—Å—É–Ω"
  - **–ß—Ç–æ —É–¥–∞–ª–µ–Ω–æ**:
    - `HydeService` –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `RagFusionService`
    - LLM –≤–∞—Ä–∏–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ —É–¥–∞–ª–µ–Ω—ã (–±—ã–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π)
    - ~300 —Å—Ç—Ä–æ–∫ prompt engineering –∫–æ–¥–∞ —É–¥–∞–ª–µ–Ω–æ
  - **–§–∞–π–ª—ã** ‚Äî `RagFusionService.cs`, `ServiceCollectionExtensions.cs`, `SearchStrategyService.cs`

### Changed

- **RAG Fusion simplified: removed LLM, added Reranker** ‚Äî —É–ø—Ä–æ—â–µ–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞ –ø–æ–∏—Å–∫–∞:
  - **–°—Ç–∞—Ä–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** (799 —Å—Ç—Ä–æ–∫, ~15 —Å–µ–∫):
    ```
    Query ‚Üí LLM Variations ‚Üí HyDE ‚Üí Vector Search ‚Üí RRF
    ```
  - **–ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** (544 —Å—Ç—Ä–æ–∫, ~5 —Å–µ–∫):
    ```
    Query ‚Üí Structural Variations ‚Üí Vector + Keyword Search ‚Üí RRF ‚Üí Reranker
    ```
  - **Structural Variations** ‚Äî –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –±–µ–∑ LLM:
    - –î–ª—è "–∫—Ç–æ X?" –≤–æ–ø—Ä–æ—Å–æ–≤: "[–∏–º—è] X", "X [–∏–º—è]", "[–∏–º—è] —ç—Ç–æ X"
    - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞
    - –ù–∏–∫–∞–∫–∏—Ö –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π, –Ω–∏–∫–∞–∫–∏—Ö LLM –≤—ã–∑–æ–≤–æ–≤
  - **Cohere Reranker** ‚Äî cross-encoder –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –æ—Ü–µ–Ω–∫–∏:
    - –¢–æ—á–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ query‚Üîdocument
    - –ú–æ–¥–µ–ª—å `rerank-v4.0-pro` (100+ —è–∑—ã–∫–æ–≤)
    - ~200ms –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–∏—Å–∫–∞
  - **–†–µ–∑—É–ª—å—Ç–∞—Ç**:
    | –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ |
    |---------|------|--------|
    | –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ | ~15 —Å–µ–∫ | ~5 —Å–µ–∫ |
    | LLM –≤—ã–∑–æ–≤—ã | 2 (variations + HyDE) | 0 |
    | –ì–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ | –í–æ–∑–º–æ–∂–Ω—ã | –ù–µ–≤–æ–∑–º–æ–∂–Ω—ã |
    | –ö–∞—á–µ—Å—Ç–≤–æ | Medium | High (reranker) |
  - **–§–∞–π–ª—ã** ‚Äî `RagFusionService.cs`

- **AskProcessingService extracted from BackgroundAskWorker** ‚Äî —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî E2E —Ç–µ—Å—Ç—ã –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ background processing:
    - `AskHandler` —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å (–Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç)
    - `BackgroundAskWorker` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ —Ñ–æ–Ω–µ
    - –¢–µ—Å—Ç—ã –∂–¥–∞–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ –±—ã–ª–æ
  - **–†–µ—à–µ–Ω–∏–µ** ‚Äî —Å–æ–∑–¥–∞–Ω `AskProcessingService`:
    - **Single Responsibility** ‚Äî —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞, –±–µ–∑ queueing
    - ~170 —Å—Ç—Ä–æ–∫ processing –ª–æ–≥–∏–∫–∏ –∏–∑–≤–ª–µ—á–µ–Ω—ã –∏–∑ BackgroundAskWorker
    - BackgroundAskWorker —Ç–µ–ø–µ—Ä—å 146 —Å—Ç—Ä–æ–∫ (–±—ã–ª–æ 400+)
    - –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é –±–µ–∑ –æ—á–µ—Ä–µ–¥–∏
  - **–ü–∞—Ç—Ç–µ—Ä–Ω Service Extraction**:
    ```
    –î–æ:  AskHandler ‚Üí BackgroundAskWorker (queue + process)
                              ‚Üì
    –ü–æ—Å–ª–µ: AskHandler ‚Üí AskQueueService ‚Üí BackgroundAskWorker
                                                  ‚Üì
                                          AskProcessingService ‚Üê E2E Tests
    ```
  - **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
    - `AskProcessingService` ‚Äî core processing logic (–º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
    - `BackgroundAskWorker` ‚Äî queue polling + delegation
    - E2E —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `AskProcessingService` –Ω–∞–ø—Ä—è–º—É—é
  - **–†–µ–∑—É–ª—å—Ç–∞—Ç**:
    - ‚úÖ E2E —Ç–µ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ Docker (test `HandleAsync_EmptyQuestion_SendsHelpText`)
    - ‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–∞ (0 errors, 0 warnings)
    - ‚úÖ –õ—É—á—à–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (SRP, –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è)
  - **–§–∞–π–ª—ã** ‚Äî `AskProcessingService.cs`, `BackgroundAskWorker.cs`, `AskHandlerE2ETests.cs`, `ServiceCollectionExtensions.cs`

### Added

- **True Hybrid Search (Vector + Keywords with RRF)** ‚Äî –Ω–∞—Å—Ç–æ—è—â–∏–π –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ —Å PostgreSQL full-text:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –Ω–µ —Ä–∞–∑–ª–∏—á–∞–µ—Ç –±–æ—Ç–∞ –æ—Ç —á–µ–ª–æ–≤–µ–∫–∞:
    - Embedding "–±–æ—Ç —Å–æ–∑–¥–∞–Ω" ‚âà "—á–µ–ª–æ–≤–µ–∫ —Å–æ–∑–¥–∞–Ω" (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Ö–æ–∂–∏!)
    - –í–æ–ø—Ä–æ—Å "—Ç—ã —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω —Å–≤–æ–µ–π —Ü–µ–ª—å—é?" –Ω–∞—Ö–æ–¥–∏–ª —Ñ–∏–ª–æ—Å–æ—Ñ–∏—é –æ –ª—é–¥—è—Ö
  - **–†–µ—à–µ–Ω–∏–µ** ‚Äî Hybrid Search –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç:
    | –ú–µ—Ç–æ–¥ | –ß—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç | –ò–Ω–¥–µ–∫—Å |
    |-------|-------------|--------|
    | **Vector (HNSW)** | –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Ö–æ–∂–µ–µ | `vector_cosine_ops` |
    | **Keyword (BM25)** | –¢–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å–ª–æ–≤ | GIN `to_tsvector('russian')` |
  - **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
    ```
    Query ‚Üí ‚î¨‚îÄ‚ñ∫ Vector Search ‚îÄ‚îÄ‚ñ∫ Candidates ‚îÄ‚îê
            ‚îÇ                                  ‚îÇ
            ‚îî‚îÄ‚ñ∫ Keyword Search ‚îÄ‚ñ∫ Candidates ‚îÄ‚î¥‚îÄ‚ñ∫ RRF Fusion ‚îÄ‚ñ∫ Results
    ```
  - **RRF (Reciprocal Rank Fusion)** –≤ SQL:
    ```sql
    COALESCE(1.0 / (60 + v.vector_rank), 0) +
    COALESCE(1.0 / (60 + k.keyword_rank), 0) as rrf_score
    ```
  - **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**:
    - `HybridSearchAsync()` –≤ EmbeddingService ‚Äî –µ–¥–∏–Ω—ã–π SQL –∑–∞–ø—Ä–æ—Å
    - Bot-directed detection —á–µ—Ä–µ–∑ regex `^—Ç—ã\s+\w+`
    - –ü—Ä–∏ bot-directed –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è hybrid search —Å keywords "–±–æ—Ç | —Å–æ–∑–¥–∞–Ω | —á—Ç–æ–±—ã | —É–º–µ–µ—Ç"
    - GIN –∏–Ω–¥–µ–∫—Å—ã —É–∂–µ –±—ã–ª–∏ –≤ —Å—Ö–µ–º–µ, —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è!
  - **–§–∞–π–ª—ã** ‚Äî `EmbeddingService.cs`, `RagFusionService.cs`

- **HyDE (Hypothetical Document Embeddings)** ‚Äî —É–ª—É—á—à–µ–Ω–∏–µ Q‚ÜíA retrieval —á–µ—Ä–µ–∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî bi-encoder –ø–ª–æ—Ö–æ —Å–≤—è–∑—ã–≤–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã —Å –æ—Ç–≤–µ—Ç–∞–º–∏:
    - –í–æ–ø—Ä–æ—Å "–¥–ª—è —á–µ–≥–æ —Ç—ã —Å–æ–∑–¥–∞–Ω?" –≤ "question space"
    - –û—Ç–≤–µ—Ç "—è —Å–æ–∑–¥–∞–Ω —á—Ç–æ–±—ã..." –≤ "answer space"
    - –≠—Ç–∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–Ω—ã–µ!
  - **–†–µ—à–µ–Ω–∏–µ** ‚Äî HyDE –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤–æ–ø—Ä–æ—Å –≤ "answer space":
    ```
    Query: "—Ç—ã —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω –∏–∑-–∑–∞ —Å–≤–æ–µ–π –≥–ª—É–ø–æ–π —Ü–µ–ª–∏?"
                    ‚Üì
             LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç
                    ‚Üì
    HyDE: "–ù–µ—Ç, —è –Ω–µ —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω. –Ø —Å–æ–∑–¥–∞–Ω —á—Ç–æ–±—ã –ø–æ–º–æ–≥–∞—Ç—å..."
                    ‚Üì
             Bi-encoder –∏—â–µ—Ç –ø–æ HyDE (–≤ answer space!)
                    ‚Üì
             –ù–∞—Ö–æ–¥–∏—Ç "—Ç—ã —Å–æ–∑–¥–∞–Ω —á—Ç–æ–±—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç—É–ø—ã–µ –≤–æ–ø—Ä–æ—Å—ã"
    ```
  - **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ RAG Fusion**:
    - HyDE –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å query variations
    - Embedding HyDE –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ batch –∑–∞–ø—Ä–æ—Å—É
    - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã HyDE –ø–æ–∏—Å–∫–∞ –º–µ—Ä–∂–∞—Ç—Å—è —á–µ—Ä–µ–∑ RRF
  - **Q‚ÜíA Transformation** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:
    - LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç, –Ω–æ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã: `["—Å–æ–∑–¥–∞–Ω —á—Ç–æ–±—ã", "–±–æ—Ç –¥–ª—è", "—Ü–µ–ª—å –±–æ—Ç–∞"]`
    - –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ queries –≤ RAG Fusion
  - **Paper**: https://arxiv.org/abs/2212.10496
  - **–§–∞–π–ª—ã** ‚Äî `HydeService.cs`, `RagFusionService.cs`, `ServiceCollectionExtensions.cs`

- **Cross-encoder reranking via Cohere API** ‚Äî —É–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞ —á–µ—Ä–µ–∑ —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥ —Å –ø–æ–º–æ—â—å—é cross-encoder:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî bi-encoder —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –ø–ª–æ—Ö–æ —Å–≤—è–∑—ã–≤–∞—é—Ç –≤–æ–ø—Ä–æ—Å—ã —Å –æ—Ç–≤–µ—Ç–∞–º–∏:
    - "–¥–ª—è —á–µ–≥–æ —Ç—ã —Å–æ–∑–¥–∞–Ω?" ‚Üí "—Ç—ã —Å–æ–∑–¥–∞–Ω —á—Ç–æ–±—ã..." –¥–∞–≤–∞–ª–æ similarity ~0.30 –≤–º–µ—Å—Ç–æ 0.70+
    - –ü—Ä–∏—á–∏–Ω–∞: bi-encoder –∫–æ–¥–∏—Ä—É–µ—Ç query –∏ document –æ—Ç–¥–µ–ª—å–Ω–æ, –Ω–µ –≤–∏–¥–∏—Ç –∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
  - **–†–µ—à–µ–Ω–∏–µ** ‚Äî Two-stage retrieval —Å cross-encoder:
    ```
    Stage 1: Bi-encoder (HNSW) ‚Üí 50 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ (~150ms)
    Stage 2: Cross-encoder (Cohere) ‚Üí re-rank top 15 (~200ms)
    ```
  - **Cross-encoder vs Bi-encoder**:
    | | Bi-encoder | Cross-encoder |
    |---|---|---|
    | –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç | Query –∏ Doc –æ—Ç–¥–µ–ª—å–Ω–æ | Query+Doc –≤–º–µ—Å—Ç–µ —á–µ—Ä–µ–∑ BERT |
    | –í–∏–¥–∏—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ | ‚ùå | ‚úÖ |
    | –°–∫–æ—Ä–æ—Å—Ç—å | ~1ms (HNSW) | ~200ms (API) |
    | Use case | Retrieval (–º–Ω–æ–≥–æ) | Reranking (–º–∞–ª–æ) |
  - **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**:
    - `CohereRerankService` ‚Äî HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è Cohere Rerank v2 API
    - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `SearchPersonalWithHybridAsync` –∏ `SearchContextOnlyAsync`
    - Graceful degradation ‚Äî –µ—Å–ª–∏ API key –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
  - **–ú–æ–¥–µ–ª—å**: `rerank-v4.0-pro` (latest, —è–Ω–≤–∞—Ä—å 2026) ‚Äî 32K context, 100+ —è–∑—ã–∫–æ–≤, self-learning
  - **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** –≤ `appsettings.json`:
    ```json
    "Reranker": {
      "Provider": "cohere",
      "ApiKey": "",
      "Model": "rerank-v4.0-pro",
      "Enabled": true
    }
    ```
  - **–§–∞–π–ª—ã** ‚Äî `CohereRerankService.cs`, `SearchStrategyService.cs`, `ServiceCollectionExtensions.cs`, `appsettings.json`

- **Relationship detection between chat participants** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ —á–∞—Ç–∞:
  - **–¶–µ–ª—å** ‚Äî —É–ª—É—á—à–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–æ—Ç–∞, –∑–Ω–∞—è –∫—Ç–æ –∫–æ–º—É –∫–µ–º –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è (–∂–µ–Ω–∞, –º—É–∂, –±—Ä–∞—Ç, –¥—Ä—É–≥ –∏ —Ç.–¥.)
  - **–ü–æ–¥—Ö–æ–¥** ‚Äî –≥–∏–±—Ä–∏–¥–Ω—ã–π (Regex + LLM):
    | –ú–µ—Ç–æ–¥ | –ö–æ–≥–¥–∞ | –ü—Ä–∏–º–µ—Ä |
    |-------|-------|--------|
    | **Real-time regex** | –í—ã—Å–æ–∫–æ-—É–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã | "—ç—Ç–æ –º–æ—è –∂–µ–Ω–∞ –ú–∞—à–∞" |
    | **Batch LLM** | –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ | "–æ–ø—è—Ç—å –∂–µ–Ω–∞ –∑–≤–æ–Ω–∏—Ç" |
  - **–¢–∏–ø—ã –æ—Ç–Ω–æ—à–µ–Ω–∏–π**: `spouse`, `partner`, `sibling`, `parent`, `child`, `friend`, `colleague`, `relative`
  - **Confidence thresholds**: ‚â•0.7 –¥–ª—è –ø–æ–∫–∞–∑–∞ –≤ –æ—Ç–≤–µ—Ç–µ, ‚â•0.5 –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ LLM, ‚â•0.3 –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
  - **–ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
    - `user_relationships` —Ç–∞–±–ª–∏—Ü–∞ —Å soft-delete (`is_active` flag)
    - `RelationshipService` ‚Äî CRUD + –æ–±—Ä–∞–±–æ—Ç–∫–∞ exclusive –æ—Ç–Ω–æ—à–µ–Ω–∏–π (spouse, partner)
    - `RelationshipExtractionService` ‚Äî regex extraction —Å source-generated –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏
    - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `FactExtractionHandler` –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM batch extraction
    - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `MemoryContextBuilder` ‚Äî –æ—Ç–Ω–æ—à–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ LLM
    - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `SaveMessage` ‚Äî fire-and-forget extraction
  - **–§–∞–π–ª—ã** ‚Äî `RelationshipService.cs`, `RelationshipExtractionService.cs`, `Models.cs`, `DatabaseInitializer.cs`, `FactExtractionHandler.cs`, `MemoryContextBuilder.cs`, `SaveMessage.cs`

### Changed

- **Two-stage retrieval for vector search (critical performance fix)** ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å vector search:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî HNSW –∏–Ω–¥–µ–∫—Å **–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è** –∏–∑-–∑–∞ —Å–ª–æ–∂–Ω–æ–≥–æ `ORDER BY Similarity DESC`
  - **Root cause** ‚Äî hybrid scoring —Ñ–æ—Ä–º—É–ª–∞ (BM25 + time decay + exact match) –≤—ã—á–∏—Å–ª—è–ª–∞—Å—å **–¥–ª—è –≤—Å–µ—Ö 125K —Å—Ç—Ä–æ–∫**
  - **–°–∏–º–ø—Ç–æ–º—ã** ‚Äî vector search –∑–∞–Ω–∏–º–∞–ª ~6 —Å–µ–∫ –≤–º–µ—Å—Ç–æ ~200ms, 4 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ = ~20 —Å–µ–∫
  - **–†–µ—à–µ–Ω–∏–µ** ‚Äî Two-stage retrieval pattern:
    1. **Stage 1 (DB)**: `ORDER BY embedding <=> vector LIMIT 200` ‚Üí HNSW Index ‚Üí ~150ms
    2. **Stage 2 (Memory)**: Re-rank 200 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø–æ hybrid —Ñ–æ—Ä–º—É–ª–µ ‚Üí ~1ms
  - **–†–µ–∑—É–ª—å—Ç–∞—Ç**:
    | –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
    |---------|------|--------|-----------|
    | Query Plan | Seq Scan | Index Scan | ‚úÖ |
    | Execution Time | 5,819 ms | 150 ms | **~39x** |
    | Buffers read | 86,493 | 998 | ~87x –º–µ–Ω—å—à–µ I/O |
  - **–û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ RAG Fusion** ‚Äî 4 parallel √ó 150ms = ~600ms –≤–º–µ—Å—Ç–æ ~20 —Å–µ–∫
  - **–§–∞–π–ª** ‚Äî `EmbeddingService.cs:SearchByVectorAsync`

- **RAG Fusion parallel vector search** ‚Äî —É—Å–∫–æ—Ä–µ–Ω–∏–µ vector search –≤ RAG Fusion:
  - **–ë—ã–ª–æ** ‚Äî 4 vector searches –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (~4-8 —Å–µ–∫)
  - **–°—Ç–∞–ª–æ** ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `Task.WhenAll` (~1-2 —Å–µ–∫)
  - **–ê–Ω–∞–ª–∏–∑** ‚Äî connection pool –∏–º–µ–µ—Ç ~95 —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∏–∑ 100, –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –±–µ–∑–æ–ø–∞—Å–µ–Ω
  - **–§–∞–π–ª** ‚Äî `RagFusionService.cs`

- **Persistent message queues with LISTEN/NOTIFY** ‚Äî –æ—á–µ—Ä–µ–¥–∏ `/ask`, `/summary` –∏ `/truth` —Ç–µ–ø–µ—Ä—å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ —Å real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî in-memory Channel –æ—á–µ—Ä–µ–¥–∏ —Ç–µ—Ä—è–ª–∏—Å—å –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ/–¥–µ–ø–ª–æ–µ, polling –¥–æ–±–∞–≤–ª—è–ª 2-5 —Å–µ–∫ latency
  - **–ë—ã–ª–æ** ‚Äî `System.Threading.Channels` (in-memory) —Å polling
  - **–°—Ç–∞–ª–æ** ‚Äî PostgreSQL —Ç–∞–±–ª–∏—Ü—ã + LISTEN/NOTIFY –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–∏
  - **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
    ```
    INSERT ‚Üí TRIGGER ‚Üí pg_notify('channel') ‚Üí Worker –ø–æ–ª—É—á–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
                                            ‚Üì
                                  Fallback polling –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
    ```
  - **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
    - ‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è (~10-50ms –≤–º–µ—Å—Ç–æ 2-5 —Å–µ–∫)
    - üíæ –ó–∞–ø—Ä–æ—Å—ã –≤—ã–∂–∏–≤–∞—é—Ç –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ
    - üîÑ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ fallback polling (30 —Å–µ–∫)
    - üìä –í–∏–¥–∏–º–æ—Å—Ç—å –æ—á–µ—Ä–µ–¥–∏ —á–µ—Ä–µ–∑ SQL
    - üßπ Auto-cleanup —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π
  - **–ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
    - `PostgresNotificationService` ‚Äî —Å–ª—É—à–∞–µ—Ç NOTIFY –∫–∞–Ω–∞–ª—ã (ask, summary, truth)
    - –¢—Ä–∏–≥–≥–µ—Ä—ã `notify_*_queue_insert()` –¥–ª—è –≤—Å–µ—Ö –æ—á–µ—Ä–µ–¥–µ–π
    - `TruthQueueService` + `BackgroundTruthWorker` ‚Äî —Ñ–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `/truth`
  - **–§–∞–π–ª—ã** ‚Äî `PostgresNotificationService.cs`, `DatabaseInitializer.cs`, `BackgroundAskWorker.cs`, `BackgroundSummaryWorker.cs`, `TruthQueueService.cs`, `BackgroundTruthWorker.cs`, `FactCheckHandler.cs`

### Improved

- **Debug logging for empty catch blocks** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω `LogDebug` –≤–æ –≤—Å–µ –ø—É—Å—Ç—ã–µ catch –±–ª–æ–∫–∏ —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º logger:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî –æ—à–∏–±–∫–∏ –ø—Ä–æ–≥–ª–∞—Ç—ã–≤–∞–ª–∏—Å—å –º–æ–ª—á–∞, –∑–∞—Ç—Ä—É–¥–Ω—è—è –æ—Ç–ª–∞–¥–∫—É
  - **–†–µ—à–µ–Ω–∏–µ** ‚Äî 10 catch –±–ª–æ–∫–æ–≤ —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É—é—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ Debug:
    - `BackgroundAskWorker.cs` ‚Äî –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    - `BackgroundSummaryWorker.cs` ‚Äî –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    - `DebugService.cs` ‚Äî –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML (2 –º–µ—Å—Ç–∞)
    - `FactCheckHandler.cs` ‚Äî –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    - `GenerateSummary.cs` ‚Äî –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    - `OpenAiCompatibleProvider.cs` ‚Äî health check failures
    - `TelegramExportParser.cs` ‚Äî –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ (2 –º–µ—Å—Ç–∞)
    - `AskQueueService.cs` ‚Äî –æ—à–∏–±–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ pending count
    - `ImportCommand.cs` ‚Äî –æ—à–∏–±–∫–∏ –æ—á–∏—Å—Ç–∫–∏ temp –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
  - **–ò—Å–∫–ª—é—á–µ–Ω–∏—è** ‚Äî static –º–µ—Ç–æ–¥—ã –±–µ–∑ logger (`MemoryHelpers`, `MetadataParser`, `AskHandlerHelpers`, `ProfileGenerationHandler.FormatActiveHours`) –æ—Å—Ç–∞–≤–ª–µ–Ω—ã —Å –ø—É—Å—Ç—ã–º–∏ catch ‚Äî —ç—Ç–æ fail-safe utility –º–µ—Ç–æ–¥—ã
  - **–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–æ–≤** ‚Äî `LogWarning` –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤ production (–º–æ–∂–Ω–æ –ø–æ–Ω–∏–∑–∏—Ç—å –¥–æ Debug –ø–æ–∑–∂–µ)

### Fixed

- **PostgresNotificationService crash on startup** ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–∞–¥–∞–ª–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å "Connection string not configured":
  - **Root cause** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å `GetConnectionString("DefaultConnection")` –≤–º–µ—Å—Ç–æ `"Default"`
  - **–§–∞–π–ª** ‚Äî `PostgresNotificationService.cs:43`

- **Exact match not working for short words** ‚Äî —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–ª–æ–≤:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî –∑–∞–ø—Ä–æ—Å "–≥–¥–µ –Ω—è–º –Ω—è–º–∞ –¥–µ–ª–∞—é—Ç" –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ "–Ω—è–º –Ω—è–º –¥–µ–ª–∞—Ç—å"
  - **Root cause** ‚Äî `ExtractIlikeWords` —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª —Å–ª–æ–≤–∞ `length > 3`, "–Ω—è–º" (3 —Å–∏–º–≤–æ–ª–∞) –∏—Å–∫–ª—é—á–∞–ª—Å—è
  - **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ** ‚Äî –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Å—Ç–µ–º–º–∏–Ω–≥ –¥–ª—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
  - **–†–µ—à–µ–Ω–∏–µ** ‚Äî `ExtractIlikeWords` —Ç–µ–ø–µ—Ä—å:
    - –í–∫–ª—é—á–∞–µ—Ç —Å–ª–æ–≤–∞ >= 3 —Å–∏–º–≤–æ–ª–æ–≤ (–≤–º–µ—Å—Ç–æ > 3)
    - –†–∞—Å—à–∏—Ä—è–µ—Ç —Å–ø–∏—Å–æ–∫ —Å—Ç–µ–º–º–∞–º–∏ ("–Ω—è–º–∞" ‚Üí "–Ω—è–º", "–¥–µ–ª–∞—é—Ç" ‚Üí "–¥–µ–ª–∞")
  - **–†–µ–∑—É–ª—å—Ç–∞—Ç** ‚Äî exact match boost —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –±–æ–ª—å—à–µ–≥–æ —á–∏—Å–ª–∞ —Å–ª–æ–≤
  - **–§–∞–π–ª** ‚Äî `TextSearchHelpers.cs`

- **RAG Fusion generating wrong variations for bot-directed questions** ‚Äî RAG Fusion –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –≤–∞—Ä–∏–∞—Ü–∏–∏ –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –±–æ—Ç–µ:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî –∑–∞–ø—Ä–æ—Å "—Ç—ã —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω –∏–∑-–∑–∞ —Å–≤–æ–µ–π –≥–ª—É–ø–æ–π —Ü–µ–ª–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è?" –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –≤–∞—Ä–∏–∞—Ü–∏–∏:
    - "–∞—Ö–∞—Ö–∞—Ö —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–ª—Å—è –≤ —Å–≤–æ–µ–π –∂–∏–∑–Ω–∏"
    - "–±–ª—è –∫–∞–∫–æ–π —Å–º—ã—Å–ª —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è"
    - –≠—Ç–æ –∏—Å–∫–∞–ª–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –∂–∏–∑–Ω–∏, –ù–ï –æ –±–æ—Ç–µ
  - **Root cause** ‚Äî RAG Fusion prompt –∏–º–µ–ª –ø—Ä–∞–≤–∏–ª–æ 4 "—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —á–∞—Ç–∞":
    - "—Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω" ‚Üí "–∞—Ö–∞—Ö–∞—Ö —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–ª—Å—è" (–æ–±—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω)
    - –ù–µ —Ä–∞–∑–ª–∏—á–∞–ª –≤–æ–ø—Ä–æ—Å—ã –æ –±–æ—Ç–µ vs –æ –ª—é–¥—è—Ö
  - **–†–µ—à–µ–Ω–∏–µ** ‚Äî HyDE (Hypothetical Document Embeddings), —Å–º. "Added" –≤—ã—à–µ:
    - –í–º–µ—Å—Ç–æ –¥–µ—Ç–µ–∫—Ü–∏–∏ "–±–æ—Ç-–≤–æ–ø—Ä–æ—Å vs –Ω–µ-–±–æ—Ç-–≤–æ–ø—Ä–æ—Å" HyDE —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏
    - LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –±–ª–∏–∑–æ–∫ –∫ —Ä–µ–∞–ª—å–Ω—ã–º –æ—Ç–≤–µ—Ç–∞–º –≤ –±–∞–∑–µ
    - –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ª—é–±—ã—Ö —Ç–∏–ø–æ–≤ –≤–æ–ø—Ä–æ—Å–æ–≤, –Ω–µ —Ç–æ–ª—å–∫–æ bot-directed
  - **–ò—Å—Ç–æ—Ä–∏—è (—É–¥–∞–ª–µ–Ω–æ)**:
    - v1: `IsBotDirectedQuestion()` regex detector ‚Äî —É–¥–∞–ª—ë–Ω
    - v2: `is_bot_directed` —Ñ–ª–∞–≥ –≤ IntentClassifier ‚Äî —É–¥–∞–ª—ë–Ω
    - –ü—Ä–∏—á–∏–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è: HyDE —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —ç–ª–µ–≥–∞–Ω—Ç–Ω–µ–µ –±–µ–∑ —è–≤–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤
  - **–§–∞–π–ª—ã** ‚Äî `HydeService.cs` (–Ω–æ–≤—ã–π), `RagFusionService.cs`, `IntentClassifier.cs` (—É–¥–∞–ª—ë–Ω IsBotDirected)

- **PostgreSQL timeout in RAG Fusion** ‚Äî —Ç–∞–π–º–∞—É—Ç –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∏–∑-–∑–∞ –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî –∑–∞–ø—Ä–æ—Å "—Ç–∞–π–ª–∞–Ω–¥ –∏ –∫–∏—Ç–∞–π –æ–¥–Ω–æ –∏ —Ç–æ–∂–µ?" –ø–∞–¥–∞–ª —Å `Npgsql.NpgsqlException: Timeout during reading attempt`
  - **Root cause** ‚Äî –∫–∞—Å–∫–∞–¥–Ω—ã–π –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º: RAG Fusion –∑–∞–ø—É—Å–∫–∞–ª 4 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö DB –∑–∞–ø—Ä–æ—Å–∞ –≤–Ω—É—Ç—Ä–∏ —É–∂–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
  - **–û–±—â–µ–µ —á–∏—Å–ª–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤** ‚Äî –¥–æ 7+: (4 RAG + 1 Context + 2 Comparison)
  - **–†–µ—à–µ–Ω–∏–µ** ‚Äî –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:
    - `RagFusionService.SearchWithFusionAsync` ‚Äî vector searches —Ç–µ–ø–µ—Ä—å sequential
    - `SearchStrategyService.SearchWithRagAsync` ‚Äî fusion –∏ context —Ç–µ–ø–µ—Ä—å sequential
    - `SearchStrategyService.SearchComparisonAsync` ‚Äî entity searches —Ç–µ–ø–µ—Ä—å sequential
  - **Trade-off** ‚Äî —á—É—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Ç–∞–π–º–∞—É—Ç–æ–≤

- **SearchComparisonAsync ignoring Topic entities** ‚Äî —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω/—Ç–æ–ø–∏–∫–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî –º–µ—Ç–æ–¥ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª —Å—É—â–Ω–æ—Å—Ç–∏ –ø–æ `EntityType.Person`, –∏–≥–Ω–æ—Ä–∏—Ä—É—è Topic, Location, Organization
  - **–ü—Ä–∏–º–µ—Ä** ‚Äî –≤–æ–ø—Ä–æ—Å "–¢–∞–π–ª–∞–Ω–¥ –∏ –ö–∏—Ç–∞–π –æ–¥–Ω–æ –∏ —Ç–æ–∂–µ?" –≤–æ–∑–≤—Ä–∞—â–∞–ª `Confidence: None` –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
  - **–†–µ—à–µ–Ω–∏–µ** ‚Äî —Ç–µ–ø–µ—Ä—å –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π (Person, Topic, Location, etc.)
  - **–§–∞–π–ª** ‚Äî `SearchStrategyService.cs:SearchComparisonAsync()`

- **Context embeddings infinite loop** ‚Äî —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∞–ª–∞—Å—å:
  - **Problem** ‚Äî `GetIndexingStatsAsync` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ –æ—Ü–µ–Ω–∫—É `totalMessages / 4` –¥–ª—è pending
  - **Root cause** ‚Äî –ú–Ω–æ–≥–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –º–æ–≥—É—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ–∫–Ω–∞ (–∫–æ—Ä–æ—Ç–∫–∏–µ –¥–∏–∞–ª–æ–≥–∏ < 5 —Å–æ–æ–±—â–µ–Ω–∏–π)
  - **Solution** ‚Äî –¢–µ–ø–µ—Ä—å —Å—á–∏—Ç–∞–µ–º –†–ï–ê–õ–¨–ù–´–ï pending —á–∞—Ç—ã (–≥–¥–µ –µ—Å—Ç—å >= 5 unprocessed —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–∫–Ω–∞)
  - **Result** ‚Äî –ö–æ–≥–¥–∞ –≤—Å–µ —á–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã, `Pending = 0` –∏ —Å–µ—Ä–≤–∏—Å —É—Ö–æ–¥–∏—Ç –≤ idle mode
  - **File** ‚Äî `ContextEmbeddingService.cs`

- **Infinite webhook retry loop** ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ, –±–æ—Ç –Ω–µ –º–æ–≥ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –Ω–µ–≥–æ, –≤–æ–∑–≤—Ä–∞—â–∞–ª 500, Telegram —Ä–µ—Ç—Ä–∞–∏–ª –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
  - **ProcessTelegramUpdate.cs** ‚Äî —Ç–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–ª–æ–≥–∏—Ä—É–µ—Ç, –Ω–æ –Ω–µ —Ä–µ—Ç—Ä–∞–∏—Ç)
  - **FactCheckHandler.cs** ‚Äî –≤ catch –±–ª–æ–∫–µ —É–±—Ä–∞–Ω `replyParameters` –∏ –¥–æ–±–∞–≤–ª–µ–Ω try-catch –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—à–∏–±–∫–∏
  - Best practice: webhook –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å non-200 —Ç–æ–ª—å–∫–æ –¥–ª—è security –æ—à–∏–±–æ–∫ (403)

- **"Message to be replied not found" errors** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω `AllowSendingWithoutReply = true` –≤–æ –≤—Å–µ SendMessage:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî –¥–∞–∂–µ —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–∞–¥–∞–ª, –µ—Å–ª–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
  - **–§–∞–π–ª—ã** ‚Äî FactCheckHandler.cs, ProcessTelegramUpdate.cs, AskHandler.cs, GenerateSummary.cs
  - **–†–µ–∑—É–ª—å—Ç–∞—Ç** ‚Äî –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç –æ—Ç–≤–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ reply-to –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

### Removed

- **Dead code cleanup in EmbeddingService & PersonalSearchService** ‚Äî —É–¥–∞–ª—ë–Ω –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥:
  - `SearchWithConfidenceAsync` ‚Äî –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ `VectorSearchBase` hybrid scoring
  - `FullTextSearchAsync` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `BuildSimilaritySql` (BM25 component)
  - `SimpleTextSearchAsync` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ exact match boost
  - `GetUserMessagesAsync`, `GetMentionsOfUserAsync` ‚Äî –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `GetPersonalMessagePoolAsync`
  - –£–¥–∞–ª–µ–Ω—ã delegate-–º–µ—Ç–æ–¥—ã –≤ EmbeddingService –¥–ª—è –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö PersonalSearchService –º–µ—Ç–æ–¥–æ–≤
  - –£–±—Ä–∞–Ω `SearchConfidenceEvaluator` –∏–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ `EmbeddingService` (—Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –≤ PersonalSearchService)
  - **–ò—Ç–æ–≥–æ**: ~350 —Å—Ç—Ä–æ–∫ –º—ë—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞ —É–¥–∞–ª–µ–Ω–æ, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

- **`/recall` command** ‚Äî –∫–æ–º–∞–Ω–¥–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ –±–æ—Ç–∞:
  - –£–¥–∞–ª—ë–Ω `RecallHandler.cs`
  - –£–¥–∞–ª–µ–Ω—ã –ø—Ä–æ–º–ø—Ç—ã `recall:*` –∏–∑ `PromptSettingsStore.cs`
  - –£–¥–∞–ª–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã –≤ –º–µ–Ω—é –±–æ—Ç–∞
  - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ `/ask` —Å –≤–æ–ø—Ä–æ—Å–æ–º "—á—Ç–æ –≥–æ–≤–æ—Ä–∏–ª @username?"

### Changed

- **RAG Fusion batch embeddings optimization** ‚Äî Major /ask performance improvement:
  - **Problem** ‚Äî RAG Fusion made 4 separate Jina API calls (original + 3 variations), each taking ~8s
  - **Solution** ‚Äî Batch all queries into a single `GetBatchEmbeddingsAsync` call
  - **Expected improvement** ‚Äî RAG Fusion time reduced from ~32s to ~8-12s
  - **Files changed** ‚Äî `EmbeddingService.cs` (added `GetBatchEmbeddingsAsync`, made `SearchByVectorAsync` public), `RagFusionService.cs`
  - **Fallback** ‚Äî If batch fails, automatically falls back to sequential calls

- **HNSW vector indexes** ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ —Å IVFFlat –Ω–∞ HNSW –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞:
  - –ü–æ–∏—Å–∫ –ø–æ 125K+ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º: ~50—Å–µ–∫ ‚Üí ~5—Å–µ–∫ (–≤ 10 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ)
  - HNSW –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç O(log n) –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ –≤–º–µ—Å—Ç–æ O(n)
  - –î–æ–±–∞–≤–ª–µ–Ω `shm_size: 2g` –≤ docker-compose –¥–ª—è PostgreSQL
  - –û–±–Ω–æ–≤–ª—ë–Ω `DatabaseInitializer.cs` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è HNSW –∏–Ω–¥–µ–∫—Å–æ–≤

- **Menu button in group chats** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—é (‚ò∞) —Å–ª–µ–≤–∞ –æ—Ç –ø–æ–ª—è –≤–≤–æ–¥–∞:
  - –í—ã–∑–æ–≤ `SetChatMenuButton` —Å —Ç–∏–ø–æ–º `MenuButtonCommands`
  - –¢–µ–ø–µ—Ä—å –∫–æ–º–∞–Ω–¥—ã –≤–∏–¥–Ω—ã –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ `/`, –Ω–æ –∏ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –º–µ–Ω—é

- **Improved RAG search for "who is X" questions** ‚Äî Better handling of identity questions:
  - **Answer-pattern variations** ‚Äî For questions like "–∫—Ç–æ –≥–æ–º–∏–∫", generates search patterns like "–í–∞—Å—è –≥–æ–º–∏–∫", "–≥–æ–º–∏–∫ —ç—Ç–æ –ü–µ—Ç—è" instead of question synonyms
  - **Entity-aware fallback** ‚Äî If LLM doesn't generate name-based variations, automatically adds them from participant list
  - **Entity boost scoring** ‚Äî Results containing both a participant name AND the entity word get 50% score boost
  - **Helper methods** ‚Äî Added `IsWhoQuestion()`, `ExtractEntityWord()`, `GenerateEntityVariations()`, `ApplyEntityBoost()`
  - Fixes issue where RAG found messages WITH the word but not messages that ANSWER the question

### Added

- **User Identity Resolution System (–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∑–æ–ª–≤–∏–Ω–≥–∞ –∏–º—ë–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)** ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–º—ë–Ω –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–º–µ–Ω–∏–ª –∏–º—è (–ë–µ–∫—Å—É–ª—Ç–∞–Ω ‚Üí Beksultan Valiev), –ø–æ–∏—Å–∫ –ø–æ —Å—Ç–∞—Ä–æ–º—É –∏–º–µ–Ω–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª
  - **–¢–∞–±–ª–∏—Ü–∞ `user_aliases`** ‚Äî —Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ –∏–º–µ–Ω–∞ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: display_name, username, —Å —Å—á—ë—Ç—á–∏–∫–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
  - **UserAliasService** ‚Äî —Å–µ—Ä–≤–∏—Å –¥–ª—è –∑–∞–ø–∏—Å–∏ –∏ —Ä–µ–∑–æ–ª–≤–∏–Ω–≥–∞ –∞–ª–∏–∞—Å–æ–≤
  - **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä** ‚Äî –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è display_name –∏ username
  - **–ú–∏–≥—Ä–∞—Ü–∏—è** ‚Äî —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–º–µ–Ω–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã messages –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è
  - **–†–µ–∑–æ–ª–≤–∏–Ω–≥** ‚Äî `NicknameResolverService.ResolveToUserIdAsync()` —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç user_aliases, –∑–∞—Ç–µ–º LLM fallback
  - **–ü–æ–∏—Å–∫ –ø–æ user_id** ‚Äî `PersonalSearchService.GetPersonalMessagePoolByUserIdAsync()` –∏—â–µ—Ç –ø–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ–º—É user_id –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫ –∏–º—ë–Ω
  - **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ‚Äî `SearchStrategyService.SearchPersonalWithHybridAsync()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–π —Ä–µ–∑–æ–ª–≤–∏–Ω–≥
  - –§–∞–π–ª—ã: `UserAliasService.cs`, `NicknameResolverService.cs`, `PersonalSearchService.cs`, `SearchStrategyService.cs`, `DatabaseInitializer.cs`
  - –ë–î: –Ω–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `user_aliases` (chat_id, user_id, alias, alias_type, usage_count, first_seen, last_seen)

- **Nickname Extraction from Replies (–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–æ–∑–≤–∏—â –∏–∑ –æ—Ç–≤–µ—Ç–æ–≤)** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–∑–≤–∏—â–∞–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:
  - **–ü—Ä–æ–±–ª–µ–º–∞** ‚Äî —É—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–∞–∑—ã–≤–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –ø—Ä–æ–∑–≤–∏—â–∞–º–∏ ("–ë–µ–∫—Å", "–ì–ª–µ–±—ã—á"), –∫–æ—Ç–æ—Ä—ã–µ –±–æ—Ç –Ω–µ –∑–Ω–∞–ª
  - **NicknameExtractionService** ‚Äî –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø—Ä–æ–∑–≤–∏—â–∞ –∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –æ–±—Ä–∞—â–µ–Ω–∏—è –≤ reply-—Å–æ–æ–±—â–µ–Ω–∏—è—Ö
  - **–ü–∞—Ç—Ç–µ—Ä–Ω—ã –æ–±—Ä–∞—â–µ–Ω–∏—è:**
    - "–ë–µ–∫—Å, —Ç—ã –ø—Ä–∞–≤" ‚Üí "–ë–µ–∫—Å" —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å user_id –∞–¥—Ä–µ—Å–∞—Ç–∞ reply
    - "–≠–π –ì–ª–µ–±, —Å–º–æ—Ç—Ä–∏" ‚Üí "–ì–ª–µ–±" —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å user_id –∞–¥—Ä–µ—Å–∞—Ç–∞
    - "–ü–µ—Ç—è: —ç—Ç–æ —Ç–µ–±–µ" ‚Üí "–ü–µ—Ç—è" —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å user_id –∞–¥—Ä–µ—Å–∞—Ç–∞
    - –ö–æ—Ä–æ—Ç–∫–∏–µ reply —Ç–∏–ø–∞ "–í–∞—Å—è!" ‚Üí "–í–∞—Å—è" —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å user_id –∞–¥—Ä–µ—Å–∞—Ç–∞
  - **–í–∞–ª–∏–¥–∞—Ü–∏—è** ‚Äî —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è —á–∞—Å—Ç—ã–µ —Å–ª–æ–≤–∞ ("–¥–∞", "–æ–∫", "–Ω—É"), —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ/–¥–ª–∏–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
  - **Fire-and-forget** ‚Äî –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
  - **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** ‚Äî –ø—Ä–æ–∑–≤–∏—â–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å `alias_type = "nickname"`, –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç `usage_count`
  - –§–∞–π–ª—ã: `NicknameExtractionService.cs`, `SaveMessage.cs`

- **Per-Chat Modes System (–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∂–∏–º–æ–≤ –¥–ª—è —á–∞—Ç–æ–≤)** ‚Äî –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —Ä–µ–∂–∏–º—ã –ø–æ–≤–µ–¥–µ–Ω–∏—è –±–æ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞:
  - **Business mode** (default for new chats) ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å, –±–µ–∑ –º–∞—Ç–∞ –∏ —à—É—Ç–æ–∫
  - **Funny mode** (default for existing chats) ‚Äî —Ç–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å –ø–æ–¥–∫–æ–ª–∫–∞–º–∏, —Å–∞—Ä–∫–∞–∑–º–æ–º, –º–∞—Ç–æ–º
  - **–ö–æ–º–∞–Ω–¥–∞ `/admin mode`** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞–º–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (—Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤, –ø—Ä–æ—Å–º–æ—Ç—Ä, –∏–∑–º–µ–Ω–µ–Ω–∏–µ)
  - **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** ‚Äî –≥–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å enum'–∞–º–∏ –¥–ª—è –ª—ë–≥–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ä–µ–∂–∏–º–æ–≤
  - **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ i18n** ‚Äî –∑–∞–ª–æ–∂–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ (`ChatLanguage` enum)
  - **–ú–∏–≥—Ä–∞—Ü–∏—è** ‚Äî —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —á–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—é—Ç `funny` —Ä–µ–∂–∏–º
  - **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ‚Äî —Ä–µ–∂–∏–º—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤ `/ask`, `/summary`, `/smart`, `/truth`
  - –§–∞–π–ª—ã: `ChatMode.cs`, `ChatSettingsStore.cs`, `ModeCommand.cs`
  - –ë–î: –Ω–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `chat_settings` (chat_id, mode, language)

- **Enhanced CLAUDE.md with LSP Workflow** ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∫–æ–¥–æ–º:
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã: LSP ‚Üí Read ‚Üí Edit
  - –û–ø–∏—Å–∞–Ω–æ –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
  - –ü—Ä–∏–º–µ—Ä—ã workflow –¥–ª—è —Ç–∏–ø–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥, –ø–æ–∏—Å–∫ –º—ë—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞)
  - –û–±–Ω–æ–≤–ª—ë–Ω –≥–ª–æ–±–∞–ª—å–Ω—ã–π `~/.claude/CLAUDE.md` –∏ –ø—Ä–æ–µ–∫—Ç–Ω—ã–π `.claude/CLAUDE.md`

- **User Guide Documentation** ‚Äî –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ (`docs/USER_GUIDE.md`):
  - –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞ (`/summary`, `/ask`, `/smart`, `/truth`)
  - –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø–∞–º—è—Ç–∏ –∏ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
  - –†–∞–∑–¥–µ–ª FAQ —Å —á–∞—Å—Ç—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏
  - –ù–∞–ø–∏—Å–∞–Ω–æ –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- **Forwarded Messages Handling (–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π)** ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–ø–æ—Å—Ç–æ–≤ –∏ –ø–µ—Ä–µ—Å—ã–ª–æ–∫:
  - **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞** ‚Äî —Ç–∏–ø (user/channel/chat/hidden_user), –∏–º—è –∞–≤—Ç–æ—Ä–∞, –¥–∞—Ç–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
  - **–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è** ‚Äî –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ –º—ã—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞—Ö** ‚Äî `üîÑ –í–∞—Å—è –ø–µ—Ä–µ—Å–ª–∞–ª –æ—Ç –∫–∞–Ω–∞–ª–∞ ¬´–ù–æ–≤–æ—Å—Ç–∏¬ª: [—Ç–µ–∫—Å—Ç]`
  - **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ** ‚Äî –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–æ–∏—Å–∫–∞ –≤–∏–¥–Ω–æ, —á—Ç–æ —ç—Ç–æ —Ä–µ–ø–æ—Å—Ç
  - –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î: –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ `is_forwarded`, `forward_origin_type`, `forward_from_name`, `forward_from_id`, `forward_date`

- **Gender Detection (–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–∞)** ‚Äî –≥–∏–±—Ä–∏–¥–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤:
  - **–ü–æ –∏–º–µ–Ω–∏** ‚Äî —Å–ª–æ–≤–∞—Ä—å –∏–∑ ~200 —Ä—É—Å—Å–∫–∏—Ö –º—É–∂—Å–∫–∏—Ö –∏ ~150 –∂–µ–Ω—Å–∫–∏—Ö –∏–º—ë–Ω (–≤–∫–ª—é—á–∞—è —É–º–µ–Ω—å—à–∏—Ç–µ–ª—å–Ω—ã–µ)
  - **–ü–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º** ‚Äî –∞–Ω–∞–ª–∏–∑ –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–æ—Ä–º –≥–ª–∞–≥–æ–ª–æ–≤ (–±—ã–ª/–±—ã–ª–∞, —Å–∫–∞–∑–∞–ª/—Å–∫–∞–∑–∞–ª–∞)
  - **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥** ‚Äî –∫–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç –æ–±–∞ –º–µ—Ç–æ–¥–∞ —Å —É—á—ë—Ç–æ–º confidence score
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å –±–æ—Ç–æ–º
  - –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —Å confidence –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø–∞–º—è—Ç–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–µ—Å—Ç–æ–∏–º–µ–Ω–∏–π

- **Roslynator.Analyzers** ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∫–æ–¥–∞:
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç unused methods, variables, parameters –≤ IDE
  - –ü–æ–º–æ–≥–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —á–∏—Å—Ç–æ—Ç—É –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã
  - –î–æ–±–∞–≤–ª–µ–Ω –∫–∞–∫ dev-dependency (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ runtime)

### Fixed

- **`/admin indexing` showing incorrect context embeddings stats** ‚Äî Fixed hardcoded `Indexed: 0`:
  - `ContextEmbeddingHandler.GetStatsAsync()` now queries real stats from database
  - Shows actual indexed count instead of hardcoded zero
  - Estimates total expected windows based on message count (1 window per ~4 messages)
  - Correctly calculates pending count

- **Jina late_chunking token limit error** ‚Äî Fixed "Input text exceeds maximum length of 8194 tokens":
  - When `late_chunking: true`, Jina concatenates all texts internally with 8192 token limit
  - Added automatic sub-batch splitting when total chars exceed 15K (~2 chars/token for Russian)
  - Single texts exceeding limit are now truncated with warning
  - Fixes indexing failures for large message batches and context windows

### Removed

- **Dead code cleanup** ‚Äî Removed unused methods and duplicate code:
  - Deleted `PersonalQuestionDetector.cs` entirely (replaced by `IntentClassifier`)
  - Removed 3 unused methods from `RerankResponse`: `HasSignificantChange()`, `GetFilteredResults()`, `FilteredOutCount()`
  - Removed `TelegramUpdateParserExtensions.IsGroupMessage()` extension method
  - Removed `EmbeddingService.GetRagContextAsync()` ‚Äî unused method
  - Removed `EmbeddingService.MyRegex()` ‚Äî unused GeneratedRegex
  - Removed `EmbeddingService.GetContextWindowAsync()` delegate ‚Äî never called
  - Removed `ContextWindowService.GetContextWindowAsync()` ‚Äî only `GetMergedContextWindowsAsync` is used
  - Removed `MetadataParser.ParseUsername()` and `ParseDisplayName()` ‚Äî unused methods
  - Replaced duplicate `RerankService.GetRussianStem()` with shared `TextSearchHelpers.GetRussianStem()`

### Changed

- **Improved hybrid search ranking** ‚Äî Better handling of slang, profanity, and recent messages:
  - Changed BM25 weight from 70/30 to 50/50 (semantic/keyword balance)
  - Added **time decay boost** (10% max): fresh messages ranked higher, half-life = 30 days
  - Added **exact keyword match boost** (15%): messages containing query words get priority
  - Fixes issue where old messages about "–≥–µ–π" ranked higher than recent "–ø–∏–¥–æ—Ä–∞—Å" messages
  - Formula: `similarity = 0.5*vector + 0.5*bm25 + 0.15*exact_match + 0.1*time_decay`
  - Applied to both `EmbeddingService` and `ContextEmbeddingService` (message + context embeddings)

- **Late Chunking for embeddings (Jina AI)** ‚Äî Better cross-chunk context preservation:
  - Batch embeddings now use `late_chunking: true` parameter
  - Each chunk embedding "knows" about surrounding chunks
  - Improves retrieval for context-dependent phrases ("–æ–Ω", "—ç—Ç–æ", "—Ç–∞–º")
  - Applied to both message embeddings and context window embeddings

- **Hybrid BM25 + Vector search** ‚Äî Better retrieval combining keyword and semantic search:
  - 70% weight for vector similarity (dense retrieval)
  - 30% weight for BM25/ts_rank_cd (sparse retrieval)
  - Added FTS index for `context_embeddings` table
  - Catches exact matches that embeddings might miss (names, terms, commands)
  - Applied to both `EmbeddingService` and `ContextEmbeddingService`

- **Topic-aware dialog segmentation** ‚Äî Smarter conversation boundaries for context embeddings:
  - Primary boundary: 30-minute time gaps (unchanged)
  - New: Topic shift markers ("–∫—Å—Ç–∞—Ç–∏", "–∞ –≤–æ–æ–±—â–µ", "btw", "–≤–æ–ø—Ä–æ—Å")
  - New: Participant pattern shifts (monologue ‚Üí group discussion)
  - Windows now contain more coherent conversations
  - Requires context reindex for improvements to take effect

- **Increased batch sizes for indexing**:
  - Message embeddings: 100 ‚Üí 500 per batch
  - Context embeddings: 100 ‚Üí 500 per batch
  - Delay between batches: 2s ‚Üí 1s
  - Faster reindexing (~3-5x speedup)

- **Switched embeddings to Jina AI** ‚Äî Better multilingual support with task-specific adapters:
  - Provider: `jina` (from HuggingFace/OpenRouter)
  - Model: `jina-embeddings-v3` ‚Äî MTEB score 65.52 (beats OpenAI & Cohere)
  - Task adapters: `retrieval.passage` for indexing, `retrieval.query` for search
  - Dimensions: 1024
  - Context: 8192 tokens (vs 512 in OpenAI)
  - Free tier: 10M tokens
  - Cost after: ~$0.02 per 1M tokens
  - **Requires full reindex** ‚Äî old embeddings incompatible

### Added

- **Nickname resolution for /ask** ‚Äî LLM-based resolution of nicknames to actual usernames:
  - When user asks about "–±–µ–∫", LLM resolves it to "–ë–µ–∫—Å—É–ª—Ç–∞–Ω" from chat users list
  - Works with any nickname/diminutive (–≥–ª–µ–±‚ÜíGleb, –∂–µ–Ω—è‚Üí–ñ–µ–Ω—è, —Å—Ç–∞—Å‚Üí–°—Ç–∞—Å–∏–∫)
  - Expands search query with resolved names for better RAG results
  - Shows resolved names in debug report
  - New service: `NicknameResolverService` with 30-min user list cache

### Fixed

- **Name transliteration bug in LLM answers** ‚Äî LLM was incorrectly transliterating names (e.g., `Gleb Bezrukov` ‚Üí `–ì–ª–µ–± –ë–µ–∑—É—Ä–æ–≤`):
  - Added rule "–ò–º–µ–Ω–∞ –ø–∏—à–∏ –¢–û–ß–ù–û –∫–∞–∫ –≤ source (–ù–ï –ø–µ—Ä–µ–≤–æ–¥–∏, –ù–ï —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∏—Ä—É–π!)" to Stage 2 grounded answer prompt
  - Added rule "source ‚Äî –∏–º—è –¢–û–ß–ù–û –∫–∞–∫ –≤ —Ç–µ–∫—Å—Ç–µ" to Stage 1 fact extraction prompt
  - Names now preserved exactly as they appear in chat context

- **SQL bug in ContextWindowService** ‚Äî `GetMergedContextWindowsAsync` used incorrect table alias `m` instead of `w`, causing "missing FROM-clause entry for table 'm'" errors

### Changed

- **Simplified Answer Verification** ‚Äî removed quotes extraction from Stage 1, now only extracts facts and not_found (faster, simpler JSON)

- **Background processing for /ask and /smart** ‚Äî moved LLM processing to a background worker to avoid Telegram webhook timeouts (~60 sec limit):

  **Architecture:**
  - `AskHandler` now immediately enqueues requests and returns (no timeout risk)
  - `BackgroundAskWorker` processes queue items with unlimited time budget
  - Uses `System.Threading.Channels` for thread-safe queue (same pattern as summary)

  **New Files:**
  - `Features/Search/Services/AskQueueService.cs` ‚Äî queue model and channel service
  - `Features/Search/Services/BackgroundAskWorker.cs` ‚Äî BackgroundService for processing

  **Benefits:**
  - No more TaskCanceledException from webhook timeouts
  - DeepSeek/other slow providers work reliably (~26 sec per call)
  - Two-stage Answer Verification has time to complete
  - User sees typing indicator while processing continues in background

- **Parallel Intent + RAG Fusion optimization** ‚Äî run intent classification and default search in parallel:

  **How it works:**
  - Start Intent Classification AND RAG Fusion search concurrently
  - For most queries (default case), use precomputed search results
  - For specialized queries (personal, temporal), run specialized search after intent is known

  **Performance:**
  - Saves ~20 seconds on default queries (max of Intent OR Search, not sum)
  - Specialized queries still work correctly (personal, temporal, comparison)

- **Conditional Two-Stage mode** ‚Äî skip fact extraction for simple questions:

  **Criteria for "simple" questions:**
  - Search confidence = High (good match, low hallucination risk)
  - Context < 2000 chars (few results, focused answer)

  **Performance:**
  - Simple questions: one-stage (saves ~15 seconds)
  - Complex questions: two-stage (anti-hallucination)

### Added

- **Two-stage Answer Verification for /ask** ‚Äî anti-hallucination improvement using fact extraction:

  **Stage 1: Fact Extraction (T=0.1)**
  - Extracts verified facts from context with source attribution
  - Extracts direct quotes with author
  - Identifies what information was asked but NOT found in context
  - Low temperature for factual precision
  - Returns structured JSON for Stage 2

  **Stage 2: Grounded Answer Generation (T=0.5)**
  - Generates answer using ONLY extracted facts
  - Cannot hallucinate facts not present in Stage 1 output
  - Preserves humor and personality
  - Explicitly mentions when information was not found

  **New Files:**
  - `Features/Search/Models/AnswerFacts.cs` ‚Äî models for extracted facts and quotes

  **Benefits:**
  - Significantly reduces hallucinations
  - Transparent fact sourcing (visible in debug reports)
  - Honest "don't know" responses when info is missing
  - Similar pattern to Summary's two-stage generation

## [2026-01-02]

### Fixed

- **Summary time filtering bug** ‚Äî context embeddings search was not filtering by date, allowing old messages to leak into daily summaries:
  - Added `SearchContextInRangeAsync` method to `ContextEmbeddingService` with time range filter
  - Updated `SmartSummaryService.GatherTopicMessagesAsync` to use time-filtered context search
  - Both message embeddings and context embeddings now properly filter by `startUtc`/`endUtc`

- **/ask context building bug** ‚Äî high-similarity results were excluded when context window expansion failed:
  - Messages exist in `message_embeddings` but not in `messages` table (e.g., from import)
  - `GetMergedContextWindowsAsync` returned empty, causing relevant results to be dropped
  - Added fallback in `ContextBuilderService`: use `ChunkText` directly when expansion fails
  - Results no longer incorrectly marked as "budget_exceeded"

### Added

- **RAG Fusion for /ask command** ‚Äî improved search recall for ambiguous queries:
  - Integrated `RagFusionService` into `SearchStrategyService.SearchContextOnlyAsync`
  - For query "–∫—Ç–æ –≥–æ–Ω–¥–æ–Ω?" generates variations: "—è –≥–æ–Ω–¥–æ–Ω", "–≥–æ–Ω–¥–æ–Ω –≤ —á–∞—Ç–µ", etc.
  - Uses LLM to generate 3 query variations
  - Searches with original + variations in parallel (4 searches total)
  - Merges results using Reciprocal Rank Fusion (RRF) algorithm
  - Results appearing in multiple query variations get boosted ranking
  - Combined with context embeddings search for best coverage

- **Intent Classification for /ask** ‚Äî LLM-based intent classification replacing simple pattern matching:

  **Intent Types:**
  - `PersonalSelf` ‚Äî questions about self ("–∫–∞–∫–æ–π —è?", "–æ–±–æ –º–Ω–µ")
  - `PersonalOther` ‚Äî questions about specific person ("—á—Ç–æ –∑–∞ —Ç–∏–ø –ì–ª–µ–±?", "@vasia")
  - `Factual` ‚Äî general questions ("—á—Ç–æ —Ç–∞–∫–æ–µ REST?")
  - `Event` ‚Äî event questions ("—á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ?")
  - `Temporal` ‚Äî time-bound questions ("–æ —á—ë–º –≥–æ–≤–æ—Ä–∏–ª–∏ –≤—á–µ—Ä–∞?")
  - `Comparison` ‚Äî comparison questions ("–∫—Ç–æ –∫—Ä—É—á–µ, X –∏–ª–∏ Y?")
  - `MultiEntity` ‚Äî multi-entity questions ("—á—Ç–æ –æ–±—â–µ–≥–æ –º–µ–∂–¥—É X –∏ Y?")

  **Features:**
  - Entity extraction (people, topics, objects)
  - Temporal reference detection ("–≤—á–µ—Ä–∞" ‚Üí -1 day, "–Ω–∞ –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–µ" ‚Üí -7 days)
  - Confidence scoring for classification
  - Fallback to pattern matching on LLM failure
  - Intent-based search strategy routing

  **New Search Methods:**
  - `SearchWithIntentAsync` ‚Äî routes to appropriate search based on intent
  - `SearchWithTimeRangeAsync` ‚Äî time-filtered embedding search
  - `SearchComparisonAsync` ‚Äî parallel search for multiple entities
  - `SearchMultiEntityAsync` ‚Äî combined search for multiple people

  **New Files:**
  - `Features/Search/Models/IntentModels.cs` ‚Äî intent classification data models
  - `Features/Search/Services/IntentClassifier.cs` ‚Äî LLM-based intent classifier

  **Debug Report Enhanced:**
  - Added intent classification info to debug report
  - Shows intent, confidence, entities, temporal references, reasoning

- **Enhanced Summary Algorithm** ‚Äî —É–ª—É—á—à–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º `/summary` —Å —Ç—Ä–µ–º—è –Ω–æ–≤—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏:

  **Thread Detection + Temporal Clustering:**
  - `ThreadDetector` ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (30-–º–∏–Ω—É—Ç–Ω—ã–µ –ø–∞—É–∑—ã)
  - –î–µ—Ç–µ–∫—Ü–∏—è reply chains —á–µ—Ä–µ–∑ `ReplyToMessageId`
  - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏–∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–π (–∫–æ–≥–¥–∞ —á—Ç–æ –æ–±—Å—É–∂–¥–∞–ª–∏)
  - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ "–≥–æ—Ä—è—á–∏—Ö –º–æ–º–µ–Ω—Ç–æ–≤" (bursts —Å–æ–æ–±—â–µ–Ω–∏–π)

  **Event/Decision Detection:**
  - `EventDetector` ‚Äî LLM-–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π –∏ —Ä–µ—à–µ–Ω–∏–π
  - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∞–∂–Ω–æ—Å—Ç–∏ —Å–æ–±—ã—Ç–∏–π (critical/notable/minor)
  - –í—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–µ—Ä–µ—à—ë–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

  **Quote Mining:**
  - `QuoteMiner` ‚Äî LLM-–ø–æ–∏—Å–∫ –∑–∞–ø–æ–º–∏–Ω–∞—é—â–∏—Ö—Å—è —Ü–∏—Ç–∞—Ç
  - –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Ü–∏—Ç–∞—Ç (funny/wise/savage/wholesome)
  - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –≥–æ—Ä—è—á–∏—Ö –º–æ–º–µ–Ω—Ç–æ–≤ –¥–∏—Å–∫—É—Å—Å–∏–π

  **Enhanced Summary Output:**
  - –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ —Å —Å–µ–∫—Ü–∏—è–º–∏: –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è, –ö–ª—é—á–µ–≤–æ–µ, –û—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –¶–∏—Ç–∞—Ç—ã –¥–Ω—è, –ì–æ—Ä—è—á–∏–µ –º–æ–º–µ–Ω—Ç—ã, –ì–µ—Ä–æ–∏ –¥–Ω—è
  - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ EventDetector + QuoteMiner –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –º–∞–ª—ã—Ö —á–∞—Ç–æ–≤ (<50 —Å–æ–æ–±—â–µ–Ω–∏–π)

  **New Files:**
  - `Features/Summary/Models/EnhancedSummaryModels.cs` ‚Äî –º–æ–¥–µ–ª–∏ –¥–ª—è enhanced summary
  - `Features/Summary/Services/ThreadDetector.cs` ‚Äî –¥–µ—Ç–µ–∫—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–¥–æ–≤
  - `Features/Summary/Services/EventDetector.cs` ‚Äî LLM-–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
  - `Features/Summary/Services/QuoteMiner.cs` ‚Äî LLM-–ø–æ–∏—Å–∫ —Ü–∏—Ç–∞—Ç

### Changed

- **Vertical Slices Architecture Refactoring** ‚Äî –ø–æ–ª–Ω–∞—è —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –≤ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–ª–∞–π—Å—ã:

  **Search Domain (`Features/Search/`):**
  - **–ú–æ–¥–µ–ª–∏** –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ `Features/Search/Models/`:
    - `SearchResult`, `SearchResponse`, `SearchConfidence` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
    - `EmbeddingStats` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
    - `ContextMessage`, `ContextWindow`, `WindowMessage` ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –æ–∫–Ω–∞
    - `MessageWindow`, `ContextSearchResult`, `ContextEmbeddingStats` ‚Äî –º–æ–¥–µ–ª–∏ –¥–ª—è context embeddings
  - **–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ø–æ–∏—Å–∫–∞** –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ `Features/Search/Services/`:
    - `EmbeddingService` ‚Äî —è–¥—Ä–æ –ø–æ–∏—Å–∫–∞ –ø–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º
    - `ContextEmbeddingService` ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (sliding windows)
    - `EmbeddingStorageService` ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –≤ –ë–î
    - `PersonalSearchService` ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ (—Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
    - `ContextWindowService` ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –æ–∫–æ–Ω
    - `RagFusionService` ‚Äî RAG Fusion —Å RRF
    - `RerankService` ‚Äî LLM-–ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ
    - `SearchConfidenceEvaluator` ‚Äî –æ—Ü–µ–Ω–∫–∞ confidence
    - `TextSearchHelpers` (static) ‚Äî —Ä–∞–±–æ—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–º (stemming, terms)
    - `NewsDumpDetector` (static) ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ "–Ω–æ–≤–æ—Å—Ç–Ω—ã—Ö –¥–∞–º–ø–æ–≤"
    - `MetadataParser` (static) ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ JSON metadata
    - `EmbeddingClient` ‚Äî –∫–ª–∏–µ–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (HuggingFace/OpenAI)
  - –£–¥–∞–ª–µ–Ω–∞ –ø–∞–ø–∫–∞ `Services/Embeddings/` ‚Äî –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ feature folder

  **Summary Domain (`Features/Summary/`):**
  - **–ú–æ–¥–µ–ª–∏** –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ `Features/Summary/Models/`:
    - `ChatStats` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞—Ç–∞
    - `MessageWithTime` ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π
    - `ExtractedFacts` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–∫—Ç—ã –∏–∑ LLM
  - **–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Å–∞–º–º–∞—Ä–∏** –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ `Features/Summary/Services/`:
    - `SmartSummaryService` ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∞–º–º–∞—Ä–∏
    - `DailySummaryService` ‚Äî –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∞–º–º–∞—Ä–∏
    - `BackgroundSummaryWorker` ‚Äî —Ñ–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
    - `SummaryQueueService` ‚Äî –æ—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Å–∞–º–º–∞—Ä–∏
    - `TopicExtractor` ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–º —á–µ—Ä–µ–∑ LLM
    - `SummaryContextBuilder` ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    - `SummaryStageExecutor` ‚Äî –¥–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è LLM –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

  **Profile Domain (`Features/Profile/`):**
  - **–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ø—Ä–æ—Ñ–∏–ª–µ–π** –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ `Features/Profile/Services/`:
    - `ProfileOrchestrator` ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è
    - `ProfileGeneratorService` ‚Äî –Ω–æ—á–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π
    - `ProfileWorkerService` ‚Äî —Ñ–æ–Ω–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ñ–∞–∫—Ç–æ–≤
    - `ProfileQueueService` ‚Äî –æ—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –∞–Ω–∞–ª–∏–∑
    - `FactExtractionHandler` ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ LLM
    - `ProfileGenerationHandler` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π —á–µ—Ä–µ–∑ LLM
    - `ProfileOptions` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞
    - `ProfileMetrics` ‚Äî –º–µ—Ç—Ä–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    - `IProfileHandler` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
  - –£–¥–∞–ª–µ–Ω–∞ –ø–∞–ø–∫–∞ `Services/Profile/`

  **Memory Domain (`Features/Memory/`):**
  - **–ú–æ–¥–µ–ª–∏** –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ `Features/Memory/Models/`:
    - `UserProfile`, `EnhancedProfile` ‚Äî –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    - `ConversationMemory`, `MemorySummary` ‚Äî –ø–∞–º—è—Ç—å –¥–∏–∞–ª–æ–≥–æ–≤
    - `UserFact`, `ProfileExtraction` ‚Äî —Ñ–∞–∫—Ç—ã –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
    - Internal Dapper records
  - **–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ø–∞–º—è—Ç–∏** –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ `Features/Memory/Services/`:
    - `LlmMemoryService` ‚Äî —Ñ–∞—Å–∞–¥ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞–º—è—Ç—å—é
    - `ProfileManagementService` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –≤ –ë–î
    - `ConversationMemoryService` ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤
    - `LlmExtractionService` ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ LLM
    - `MemoryContextBuilder` ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø—Ä–æ–º–ø—Ç–æ–≤
    - `MemoryHelpers` ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ö–µ–ª–ø–µ—Ä—ã
  - –£–¥–∞–ª–µ–Ω–∞ –ø–∞–ø–∫–∞ `Services/Memory/`

  **Indexing Domain (`Features/Indexing/`):**
  - **–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏** –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ `Features/Indexing/Services/`:
    - `BackgroundEmbeddingService` ‚Äî —Ñ–æ–Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
    - `EmbeddingOrchestrator` ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞
    - `BatchProcessor` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞—Ç—á–µ–π —Å rate limiting
    - `MessageEmbeddingHandler` ‚Äî –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
    - `ContextEmbeddingHandler` ‚Äî –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –æ–∫–æ–Ω
    - `IEmbeddingHandler` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
    - `IndexingOptions` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    - `IndexingMetrics` ‚Äî –º–µ—Ç—Ä–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  - –£–¥–∞–ª–µ–Ω–∞ –ø–∞–ø–∫–∞ `Services/Indexing/`

  **Messages Domain (`Features/Messages/`):**
  - **–°–µ—Ä–≤–∏—Å—ã –∏–º–ø–æ—Ä—Ç–∞** –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ `Features/Messages/Services/`:
    - `ChatImportService` ‚Äî –∏–º–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞ –∏–∑ —ç–∫—Å–ø–æ—Ä—Ç–∞ Telegram Desktop
    - `TelegramExportParser` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ HTML —ç–∫—Å–ø–æ—Ä—Ç–∞ Telegram

  **LLM Domain (`Features/Llm/`):**
  - **–í—Å–µ LLM —Å–µ—Ä–≤–∏—Å—ã** –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ `Features/Llm/Services/`:
    - `ILlmProvider` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ + `LlmRequest`, `LlmResponse` DTOs
    - `LlmRouter` ‚Äî —Ä–æ—É—Ç–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–∂–¥—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ —Å fallback
    - `LlmProviderFactory` ‚Äî —Ñ–∞–±—Ä–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ + `LlmProviderOptions`
    - `OpenAiCompatibleProvider` ‚Äî OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä + `OpenAiProviderConfig`
    - `OpenRouterUsageService` ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è OpenRouter API
  - –£–¥–∞–ª–µ–Ω–∞ –ø–∞–ø–∫–∞ `Services/Llm/`

  **Webhook Domain (`Features/Webhook/`):**
  - **Telegram-—Å–µ—Ä–≤–∏—Å—ã** –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ `Features/Webhook/Services/`:
    - `TelegramPollingService` ‚Äî polling-—Ä–µ–∂–∏–º –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
    - `TelegramHtmlSanitizer` ‚Äî —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è HTML –¥–ª—è Telegram

  **Admin Domain (`Features/Admin/`):**
  - **–°–µ—Ä–≤–∏—Å—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏** –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ `Features/Admin/Services/`:
    - `LogCollector` ‚Äî —Å–±–æ—Ä –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    - `DailyLogReportService` ‚Äî –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á—ë—Ç—ã –ª–æ–≥–æ–≤
    - `DebugService` ‚Äî –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è + `DebugReport`, `DebugSearchResult`, `DebugStage`

  **Infrastructure Layer (`Infrastructure/`):**
  - **Stores** –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ `Infrastructure/Settings/`:
    - `AdminSettingsStore` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    - `PromptSettingsStore` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤

### Removed

- **`OpenRouterClient`** ‚Äî —É–¥–∞–ª—ë–Ω legacy wrapper –Ω–∞–¥ `LlmRouter`:
  - –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç `LlmRouter` –Ω–∞–ø—Ä—è–º—É—é
  - –£–¥–∞–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã `OpenRouterClientIntegrationTests`
  - –£–¥–∞–ª–µ–Ω–∞ DI-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–∑ `ServiceCollectionExtensions.cs`
- **–ü–∞–ø–∫–∞ `Services/`** ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∞, –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ feature folders

### Technical

- **–ü–æ–ª–Ω—ã–µ vertical slices**: –∫–∞–∂–¥—ã–π –¥–æ–º–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω
- **–ü–∞–ø–∫–∞ `Services/` –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∞** ‚Äî –≤—Å–µ 52 —Ñ–∞–π–ª–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ feature folders
- –£–ª—É—á—à–µ–Ω–∞ –º–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
- DI —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤ `ServiceCollectionExtensions.cs`
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: –ø—É–±–ª–∏—á–Ω—ã–µ API –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã

## [2025-12-31]

### Added

- **End-to-End Tests for /ask Command** ‚Äî –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å Testcontainers:
  - `AskHandlerE2ETests` ‚Äî 4 —Å—Ü–µ–Ω–∞—Ä–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Ä–∞–±–æ—Ç—ã /ask –∫–æ–º–∞–Ω–¥—ã
  - Testcontainers PostgreSQL —Å pgvector –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  - DatabaseFixture —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π —Å—Ö–µ–º—ã –ë–î
  - –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç: –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –æ–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã, –ø—É—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–∫ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API –∫–ª—é—á–∞–º–∏ (LLM/Embeddings), —Ç–∞–∫ –∏ —Å –º–æ–∫–∞–º–∏
  - –ü–∞–∫–µ—Ç—ã: Moq 4.20.72, Testcontainers.PostgreSql 4.2.0


- **/admin indexing Command** ‚Äî –Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (message/context)
  - –í–∏–∑—É–∞–ª—å–Ω—ã–µ progress bar –¥–ª—è –∫–∞–∂–¥–æ–≥–æ handler'–∞
  - –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: Total, Indexed, Pending items
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–æ–≤–æ–π Pipeline/Orchestrator –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
  - –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ñ–æ–Ω–æ–≤–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –±–µ–∑ SSH –¥–æ—Å—Ç—É–ø–∞

- **Full Context Reindex Command** ‚Äî –∫–æ–º–∞–Ω–¥–∞ –ø–æ–ª–Ω–æ–π —Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤:
  - `/admin context_reindex all` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø–æ–ª–Ω–æ–π —Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
  - `/admin context_reindex all confirm` ‚Äî —É–¥–∞–ª–∏—Ç—å –í–°–ï –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –∏–∑ –≤—Å–µ—Ö —á–∞—Ç–æ–≤
  - –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `ContextEmbeddingService.DeleteAllContextEmbeddingsAsync()` ‚Äî –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
  - BackgroundService –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–Ω—ë—Ç –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é —Å –Ω—É–ª—è –¥–ª—è –≤—Å–µ—Ö —á–∞—Ç–æ–≤
  - –ü–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª–æ–≥–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –æ–∫–æ–Ω –∏–ª–∏ –ø–æ—Å–ª–µ –±–∞–≥—Ñ–∏–∫—Å–æ–≤

- **Hybrid Embedding Search** ‚Äî –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤:
  - **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** ("—è –≥–æ–Ω–¥–æ–Ω?", "@username"):
    - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –≤ `message_embeddings` (—Ç–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) + `context_embeddings` (–ø–æ–ª–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏)
    - Fallback –Ω–∞ `context_embeddings` –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã —Ç–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–æ—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏ –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã –¥–∏–∞–ª–æ–≥–∞
  - **–û–±—ã—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** ("–æ —á—ë–º —Å–ø–æ—Ä–∏–ª–∏?"):
    - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –≤ `context_embeddings` (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç) + `message_embeddings` (—Ç–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è)
    - –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ message_id —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ª—É—á—à–µ–≥–æ similarity
    - Context windows –ø–æ–ª—É—á–∞—é—Ç 1.0x similarity, –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è 0.85x
  - **Summary (/summary)**:
    - –î–ª—è –∫–∞–∂–¥–æ–π —Ç–µ–º—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫: `message_embeddings` (—Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ) + `context_embeddings` (–ø–æ–ª–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏)
    - –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ ~15 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π + ~5 –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –æ–∫–æ–Ω per —Ç–µ–º–∞
    - –ë–æ–ª–µ–µ —Å–≤—è–∑–Ω—ã–µ –∏ –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å–∞–º–º–∞—Ä–∏ —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –¥–∏–∞–ª–æ–≥–æ–≤
  - –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `ContextEmbeddingService.GetContextWindowsByMessageIdsAsync()` ‚Äî –ø–æ–∏—Å–∫ –æ–∫–æ–Ω –ø–æ —Å–ø–∏—Å–∫—É message_id
  - –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `AskHandler.SearchPersonalWithHybridAsync()` ‚Äî –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
  - –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω `AskHandler.SearchContextOnlyAsync()` ‚Äî —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±–∞ —Ç–∏–ø–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
  - –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω `SmartSummaryService` ‚Äî –∏–Ω—ä–µ–∫—Ü–∏—è `ContextEmbeddingService` –∏ –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–º–∞–º

### Changed
- **EmbeddingService Refactoring** ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ God Object –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:
  - `EmbeddingService` —Å–æ–∫—Ä–∞—â—ë–Ω —Å 1715 –¥–æ 943 —Å—Ç—Ä–æ–∫ ‚Äî –Ω–∞ 45% –º–µ–Ω—å—à–µ –∫–æ–¥–∞
  - –¢–µ–ø–µ—Ä—å –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–µ—Ä–≤–∏—Å–∞–º (backward compatible)
  - –ù–æ–≤—ã–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:
    - `EmbeddingStorageService` ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏ –≤ –ë–î
    - `PersonalSearchService` ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (GetUserMessagesAsync, GetMentionsOfUserAsync, GetPersonalContextAsync)
    - `ContextWindowService` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏ (GetContextWindowAsync, GetMergedContextWindowsAsync)
  - –ü—É–±–ª–∏—á–Ω—ã–π API `EmbeddingService` –æ—Å—Ç–∞–ª—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî –≤—Å–µ –º–µ—Ç–æ–¥—ã –¥–µ–ª–µ–≥–∏—Ä—É—é—Ç—Å—è
  - –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ SRP (Single Responsibility Principle)
  - –£–ø—Ä–æ—â–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–æ–¥–∞

- **Database Query Optimization** ‚Äî —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ N+1 –ø—Ä–æ–±–ª–µ–º –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ –ë–î:
  - **ContextWindowService.GetMergedContextWindowsAsync**: **30 –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí 1 –∑–∞–ø—Ä–æ—Å** (30x –±—ã—Å—Ç—Ä–µ–µ!)
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `LATERAL JOIN` –≤–º–µ—Å—Ç–æ —Ü–∏–∫–ª–∞ —Å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–º–∏—Å—è –∑–∞–ø—Ä–æ—Å–∞–º–∏
    - –î–ª—è 10 —Å–æ–æ–±—â–µ–Ω–∏–π: –±—ã–ª–æ 30 DB roundtrips, —Å—Ç–∞–ª–æ 1 –∑–∞–ø—Ä–æ—Å
    - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ `/ask` –ø—Ä–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
  - **PersonalSearchService.GetPersonalContextAsync**: **4 –∑–∞–ø—Ä–æ—Å–∞ ‚Üí 1 –∑–∞–ø—Ä–æ—Å** (4x –±—ã—Å—Ç—Ä–µ–µ!)
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `UNION` –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π
    - –í–º–µ—Å—Ç–æ —Ü–∏–∫–ª–∞ –ø–æ –∏–º–µ–Ω–∞–º (username + displayName) —Å 2 –∑–∞–ø—Ä–æ—Å–∞–º–∏ –Ω–∞ –∫–∞–∂–¥–æ–µ
    - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ –ª–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö —Ç–∏–ø–∞ "–∫–æ–≥–¥–∞ –Ø –≥–æ–≤–æ—Ä–∏–ª..." –∏–ª–∏ "@username –∫–æ–≥–¥–∞..."
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ANY()` –æ–ø–µ—Ä–∞—Ç–æ—Ä –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–º—ë–Ω –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ
  - –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç latency –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

- **Database Index Optimization** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:
  - **idx_message_embeddings_metadata_gin** ‚Äî GIN –∏–Ω–¥–µ–∫—Å –Ω–∞ JSONB –ø–æ–ª–µ `metadata`:
    - –£—Å–∫–æ—Ä—è–µ—Ç JSON-–∑–∞–ø—Ä–æ—Å—ã –≤ PersonalSearchService (–ø–æ–∏—Å–∫ –ø–æ Username/DisplayName)
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `jsonb_path_ops` –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  - **idx_message_embeddings_text_search** ‚Äî GIN –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞:
    - –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ `chunk_text` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `to_tsvector('russian', chunk_text)` –¥–ª—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
  - **idx_messages_user_date** ‚Äî –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π –∏–Ω–¥–µ–∫—Å `(chat_id, from_user_id, date_utc DESC)`:
    - –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø–æ–∏—Å–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —á–∞—Ç–µ
    - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ PersonalSearchService –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∞–≤—Ç–æ—Ä—É
  - –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ `DatabaseInitializer.CreateIndexesAsync()`

- **AdminCommandHandler Command Pattern Refactoring** ‚Äî —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Command Pattern:
  - `AdminCommandHandler` —Å–æ–∫—Ä–∞—â—ë–Ω —Å 1504 –¥–æ 119 —Å—Ç—Ä–æ–∫ (**—Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ 92%**, -1385 —Å—Ç—Ä–æ–∫!)
  - –°–æ–∑–¥–∞–Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Command Pattern:
    - `IAdminCommand` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∫–æ–º–∞–Ω–¥
    - `AdminCommandBase` ‚Äî –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å —Å –æ–±—â–∏–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –∏ —É—Ç–∏–ª–∏—Ç–∞–º–∏
    - `AdminCommandRegistry` ‚Äî —Ä–µ–µ—Å—Ç—Ä –∫–æ–º–∞–Ω–¥ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
    - `AdminCommandContext` ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
  - **–í–°–ï –∫–æ–º–∞–Ω–¥—ã** –∏–∑–≤–ª–µ—á–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã (24 –∫–æ–º–∞–Ω–¥—ã):
    - **Monitoring** (5): `StatusCommand`, `ReportCommand`, `ChatsCommand`, `IndexingCommand`, `HelpCommand`
    - **Debug** (1): `DebugCommand` ‚Äî —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (`/admin debug on/off`, `/admin debug`)
    - **Settings** (3): `SetSummaryTimeCommand`, `SetReportTimeCommand`, `SetTimezoneCommand`
    - **LLM Management** (4): `LlmListCommand` (—Å–ø–∏—Å–æ–∫), `LlmTestCommand` (—Ç–µ—Å—Ç), `LlmSetCommand` (—É—Å—Ç–∞–Ω–æ–≤–∫–∞ default), `LlmToggleCommand` (–≤–∫–ª/–≤—ã–∫–ª)
    - **Import** (1): `ImportCommand` ‚Äî –∏–º–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞ –∏–∑ Telegram export (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π file upload)
    - **Prompt Management** (4): `PromptsCommand` (—Å–ø–∏—Å–æ–∫), `PromptCommand` (–ø—Ä–æ—Å–º–æ—Ç—Ä/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ), `PromptResetCommand`, `PromptTagCommand`
    - **User Management** (2): `NamesCommand` (—Å–ø–∏—Å–æ–∫ –∏–º—ë–Ω), `RenameCommand` (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ)
    - **Embedding Management** (4): `ReindexCommand` (–ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è message embeddings), `ContextCommand` (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ context embeddings), `ContextReindexCommand` (–ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è context embeddings)
  - `AdminCommandHandler` —Ç–µ–ø–µ—Ä—å ‚Äî —á–∏—Å—Ç—ã–π —Ä–æ—É—Ç–µ—Ä (119 —Å—Ç—Ä–æ–∫):
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    - –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `AdminCommandRegistry`
    - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    - –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥–∞—Ö
  - –£–ª—É—á—à–µ–Ω–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å: –∫–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
  - –£–ø—Ä–æ—â–µ–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∞–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥: –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å
  - DI —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ `ServiceCollectionExtensions.cs`:
    - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `registry.Register<T>(name)`
    - –ö–∞—Å—Ç–æ–º–Ω–∞—è factory –¥–ª—è `LlmToggleCommand` (—Ä–∞–∑–Ω—ã–µ bool –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è llm_on/llm_off)
  - –£–±—Ä–∞–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ `AdminCommandHandler`

- **LlmMemoryService Refactoring** ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –ø–∞–º—è—Ç–∏ –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
  - `LlmMemoryService` —Å–æ–∫—Ä–∞—â—ë–Ω —Å 734 –¥–æ 116 —Å—Ç—Ä–æ–∫ (**—Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ 84%**, -618 —Å—Ç—Ä–æ–∫!)
  - –ò–∑–≤–ª–µ—á–µ–Ω—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –≤ `Services/Memory/`:
    - **`ProfileManagementService`** (~250 —Å—Ç—Ä–æ–∫) ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
      - GetProfileAsync, GetEnhancedProfileAsync, GetUserFactsAsync
      - UpdateProfileAsync, IncrementInteractionCountAsync
      - –†–∞–±–æ—Ç–∞ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ user_profiles –∏ user_facts
    - **`ConversationMemoryService`** (~110 —Å—Ç—Ä–æ–∫) ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤:
      - GetRecentMemoriesAsync, StoreMemoryAsync
      - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π (keep last 20)
      - –†–∞–±–æ—Ç–∞ —Å —Ç–∞–±–ª–∏—Ü–µ–π conversation_memory
    - **`LlmExtractionService`** (~160 —Å—Ç—Ä–æ–∫) ‚Äî LLM-–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:
      - ExtractProfileUpdatesAsync ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ–≤, —á–µ—Ä—Ç, –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –∏–∑ –¥–∏–∞–ª–æ–≥–∞
      - GenerateMemorySummaryAsync ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∑—é–º–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
      - –û—á–∏—Å—Ç–∫–∞ JSON-–æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç markdown code blocks
    - **`MemoryContextBuilder`** (~150 —Å—Ç—Ä–æ–∫) ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è LLM:
      - BuildMemoryContextAsync ‚Äî –±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (facts, traits, recent questions)
      - BuildEnhancedContextAsync ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (summary, communication style, user_facts)
      - FilterRelevantFacts ‚Äî —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ñ–∞–∫—Ç–æ–≤ –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∫ –≤–æ–ø—Ä–æ—Å—É
    - **`MemoryHelpers`** (static) ‚Äî —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞–º—è—Ç—å—é:
      - ParseJsonArray, GetJsonStringArray, MergeLists
      - TruncateText, GetTimeAgo
  - **Models.cs** ‚Äî –≤—Å–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª:
    - Public models: UserProfile, EnhancedProfile, UserFact, ConversationMemory
    - Extraction models: ProfileExtraction, MemorySummary
    - Dapper records: UserProfileRecord, ConversationMemoryRecord, EnhancedProfileRecord, UserFactRecord
  - `LlmMemoryService` —Ç–µ–ø–µ—Ä—å ‚Äî —Ç–æ–Ω–∫–∏–π facade (116 —Å—Ç—Ä–æ–∫):
    - –î–µ–ª–µ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –≤—ã–∑–æ–≤—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–µ—Ä–≤–∏—Å–∞–º
    - –°–æ—Ö—Ä–∞–Ω—ë–Ω –ø—É–±–ª–∏—á–Ω—ã–π API –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    - –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ (extraction + storage)
  - –£–ª—É—á—à–µ–Ω–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å: –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –∏ mock-friendly
  - –£–ø—Ä–æ—â–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞: –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ª–æ–≥–∏–∫–µ –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç –¥—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: profile management, conversation memory, context building, LLM extraction

- **AskHandler Service Extraction Refactoring** ‚Äî –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ `/ask` –∏ `/smart` –∫–æ–º–∞–Ω–¥:
  - **–≠—Ç–∞–ø 1**: `AskHandler` —Å–æ–∫—Ä–∞—â—ë–Ω —Å 893 –¥–æ 440 —Å—Ç—Ä–æ–∫ (**-51%**, -453 —Å—Ç—Ä–æ–∫–∏)
    - –ò–∑–≤–ª–µ—á–µ–Ω–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:
      - **`SearchStrategyService`** (~230 —Å—Ç—Ä–æ–∫) ‚Äî —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–∏—Å–∫–∞ (personal hybrid + context-only)
      - **`ContextBuilderService`** (~120 —Å—Ç—Ä–æ–∫) ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å token budget (4000 tokens)
      - **`AnswerGeneratorService`** (~160 —Å—Ç—Ä–æ–∫) ‚Äî LLM –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å debug support
  - **–≠—Ç–∞–ø 2**: `AskHandler` —Å–æ–∫—Ä–∞—â—ë–Ω —Å 440 –¥–æ 272 —Å—Ç—Ä–æ–∫ (**-38%**, -168 —Å—Ç—Ä–æ–∫)
    - –î–∞–ª—å–Ω–µ–π—à–µ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏:
      - **`AskHandlerHelpers`** (static) ‚Äî —É—Ç–∏–ª–∏—Ç—ã: ParseQuestion, GetDisplayName, ParseTimestamp, EstimateTokens
      - **`PersonalQuestionDetector`** ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ ("—è", "@username")
      - **`DebugReportCollector`** ‚Äî —Å–±–æ—Ä debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤
      - **`ConfidenceGateService`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ confidence + early returns –¥–ª—è None/Low
  - **–ò—Ç–æ–≥–æ**: `AskHandler` —Å–æ–∫—Ä–∞—â—ë–Ω —Å **893 –¥–æ 272 —Å—Ç—Ä–æ–∫** (**—Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ 70%**, -621 —Å—Ç—Ä–æ–∫–∞!)
  - `AskHandler` —Ç–µ–ø–µ—Ä—å ‚Äî –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä (272 —Å—Ç—Ä–æ–∫–∏):
    - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ memory loading + search
    - –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–π –ª–æ–≥–∏–∫–∏ –≤ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
    - –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  - –£–ª—É—á—à–µ–Ω–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å: –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω
  - –£–ø—Ä–æ—â–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞: –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ª—é–±–æ–π —á–∞—Å—Ç–∏ –ª–æ–≥–∏–∫–∏ –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç –¥—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º, debug reporting, personal detection, HTML sanitization

- **Profile System Pipeline Refactoring** ‚Äî —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ—Ñ–∏–ª–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Pipeline/Orchestrator –ø–∞—Ç—Ç–µ—Ä–Ω–∞:
  - `ProfileWorkerService` —Å–æ–∫—Ä–∞—â—ë–Ω —Å 241 –¥–æ 71 —Å—Ç—Ä–æ–∫ ‚Äî —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  - `ProfileGeneratorService` —Å–æ–∫—Ä–∞—â—ë–Ω —Å 326 –¥–æ 78 —Å—Ç—Ä–æ–∫ ‚Äî —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ scheduling –∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  - –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:
    - `IProfileHandler` ‚Äî –æ–±—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø—Ä–æ—Ñ–∏–ª–µ–π
    - `ProfileOrchestrator` ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –æ–±–æ–∏—Ö pipeline stages
    - `FactExtractionHandler` ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ–≤ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
    - `ProfileGenerationHandler` ‚Äî –Ω–æ—á–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–ª—É–±–æ–∫–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π
  - `ProfileMetrics` –Ω–∞ –±–∞–∑–µ `System.Diagnostics.Metrics` ‚Äî thread-safe –º–µ—Ç—Ä–∏–∫–∏
  - `ProfileOptions` ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
  - –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å: –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã
  - –£–ø—Ä–æ—â—ë–Ω–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —ç—Ç–∞–ø–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π
  - –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ handler'–∞–º –∏ —Ç–∏–ø–∞–º –æ—à–∏–±–æ–∫ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
  - –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏: –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –µ—Å–ª–∏ –µ—Å—Ç—å –±–æ–ª—å—à–µ —Ä–∞–±–æ—Ç—ã

- **Embedding Indexing Pipeline Refactoring** ‚Äî —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ñ–æ–Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Pipeline/Orchestrator –ø–∞—Ç—Ç–µ—Ä–Ω–∞:
  - `BackgroundEmbeddingService` —Å–æ–∫—Ä–∞—â—ë–Ω —Å 215 –¥–æ 84 —Å—Ç—Ä–æ–∫ ‚Äî —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  - –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:
    - `IEmbeddingHandler` ‚Äî –æ–±—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (message/context embeddings)
    - `EmbeddingOrchestrator` ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è pipeline –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö handlers
    - `BatchProcessor` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞—Ç—á–∞–º–∏ + rate limiting + error tracking
    - `MessageEmbeddingHandler` ‚Äî –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    - `ContextEmbeddingHandler` ‚Äî –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –æ–∫–æ–Ω (sliding windows)
  - `IndexingMetrics` –Ω–∞ –±–∞–∑–µ `System.Diagnostics.Metrics` ‚Äî thread-safe –º–µ—Ç—Ä–∏–∫–∏ —Å Counter/Histogram
  - `IndexingOptions` ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
  - –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å: –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –∏ –ª–µ–≥–∫–æ –º–æ–∫–∞—é—Ç—Å—è
  - –£–ø—Ä–æ—â—ë–Ω–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `IEmbeddingHandler`
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTTP 429 (TooManyRequests) —Å retry delay
  - –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ handler'–∞–º –∏ —Ç–∏–ø–∞–º –æ—à–∏–±–æ–∫ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

- **Improved Context Quality** ‚Äî —É–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:
  - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—É—á–∞—é—Ç –∫–∞–∫ —Ç–æ—á–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã, —Ç–∞–∫ –∏ –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–æ–≤
  - –û–±—ã—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∫–æ–º–±–∏–Ω–∏—Ä—É—é—Ç —à–∏—Ä–æ–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (–æ–∫–Ω–∞) —Å —Ç–æ—á–Ω—ã–º–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º–∏ (—Å–æ–æ–±—â–µ–Ω–∏—è)
  - Summary —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–æ –∏ –ø–æ–ª–Ω—ã–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –ø–æ —Ç–µ–º–∞–º

- **Optimized Context Building** ‚Äî –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ `/ask`:
  - `BuildContextWithWindowsAsync` —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `context_text` –Ω–∞–ø—Ä—è–º—É—é –∏–∑ `context_embeddings`
  - –£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ: –±–æ–ª—å—à–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç `GetMergedContextWindowsAsync` –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –ø–æ–ª–Ω—ã–µ –æ–∫–Ω–∞
  - –ù–æ–≤—ã–π —Ñ–ª–∞–≥ `SearchResult.IsContextWindow` ‚Äî –æ—Ç–º–µ—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
  - –≠–∫–æ–Ω–æ–º–∏—è 2-3 SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ messages —Ç–∞–±–ª–∏—Ü—É –Ω–∞ –∫–∞–∂–¥—ã–π `/ask` –∑–∞–ø—Ä–æ—Å
  - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ –æ–±–æ–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (`context_embeddings` + `message_embeddings`) —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ

### Technical
- –í—Å–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ `Task.WhenAll` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
- –ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã `message_embeddings` –∏ `context_embeddings`
- –û–±–∞ —Ç–∏–ø–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ —Ç–µ–ø–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø–æ–∏—Å–∫–∞

## [2025-12-30]

### Changed
- **Context-Only Search** ‚Äî —É–ø—Ä–æ—â—ë–Ω –ø–æ–∏—Å–∫, —É–±—Ä–∞–Ω RAG Fusion:
  - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ `context_embeddings` (–æ–∫–Ω–∞ –ø–æ 10 —Å–æ–æ–±—â–µ–Ω–∏–π)
  - –£–±—Ä–∞–Ω `RagFusionService` –∏–∑ `AskHandler` ‚Äî —ç–∫–æ–Ω–æ–º–∏—è 3-4 —Å–µ–∫ –Ω–∞ LLM –≤–∞—Ä–∏–∞—Ü–∏—è—Ö
  - –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `SearchContextOnlyAsync` ‚Äî –ø—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–º –æ–∫–Ω–∞–º
  - –£–¥–∞–ª—ë–Ω `MergeSearchResultsAsync` ‚Äî –Ω–µ –Ω—É–∂–µ–Ω –±–µ–∑ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **One-Stage LLM Generation** ‚Äî –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–≤—É—Ö LLM-–≤—ã–∑–æ–≤–æ–≤ –≤ –æ–¥–∏–Ω:
  - –ë—ã–ª Two-Stage: Stage 1 (—Ñ–∞–∫—Ç—ã T=0.1) + Stage 2 (—é–º–æ—Ä T=0.6) = 2 –≤—ã–∑–æ–≤–∞
  - –¢–µ–ø–µ—Ä—å One-Stage: –æ–¥–∏–Ω –≤—ã–∑–æ–≤ —Å T=0.5 ‚Äî —ç–∫–æ–Ω–æ–º–∏—è ~1-2 —Å–µ–∫
  - –£–¥–∞–ª—ë–Ω –º–µ—Ç–æ–¥ `IsFactsEmpty` ‚Äî –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω
- **Dynamic Dialog Windows** ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –æ–∫–Ω–∞ –ø–æ –≥—Ä–∞–Ω–∏—Ü–∞–º –¥–∏–∞–ª–æ–≥–æ–≤:
  - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø—Ä–æ–º–µ–∂—É—Ç–∫–∞–º (>30 –º–∏–Ω = –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥)
  - –ú–∞–ª–µ–Ω—å–∫–∏–µ –¥–∏–∞–ª–æ–≥–∏ (5-15 —Å–æ–æ–±—â–µ–Ω–∏–π) ‚Üí –æ–¥–Ω–æ –æ–∫–Ω–æ —Ü–µ–ª–∏–∫–æ–º
  - –ë–æ–ª—å—à–∏–µ –¥–∏–∞–ª–æ–≥–∏ ‚Üí —Å–∫–æ–ª—å–∑—è—â–∏–µ –æ–∫–Ω–∞ –≤–Ω—É—Ç—Ä–∏ –¥–∏–∞–ª–æ–≥–∞
  - –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `SegmentIntoDialogs()` –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
  - –£–±—Ä–∞–Ω—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –æ–∫–Ω–∞ –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ –¥–∏–∞–ª–æ–≥–∏

### Added
- **Context-Aware Embeddings (Sliding Windows)** ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏:
  - –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `context_embeddings` ‚Äî —Ö—Ä–∞–Ω–∏—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–ª—è –æ–∫–æ–Ω –∏–∑ 10 —Å–æ–æ–±—â–µ–Ω–∏–π
  - `ContextEmbeddingService` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–æ–∏—Å–∫ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–º –æ–∫–Ω–∞–º
  - –°–∫–æ–ª—å–∑—è—â–∏–µ –æ–∫–Ω–∞: —Ä–∞–∑–º–µ—Ä 10 —Å–æ–æ–±—â–µ–Ω–∏–π, —à–∞–≥ 3 (–ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ 7 —Å–æ–æ–±—â–µ–Ω–∏–π)
  - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞: "–î–∞, —Å–æ–≥–ª–∞—Å–µ–Ω" —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –≤–º–µ—Å—Ç–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
  - –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ –≤ `/ask`: RAG Fusion + Context Embeddings –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
  - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—É—á–∞—é—Ç –±—É—Å—Ç +0.1 –∫ similarity

- **Background Summary Processing** ‚Äî —Ñ–æ–Ω–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—ã–∂–∏–º–æ–∫:
  - `SummaryQueueService` ‚Äî in-memory –æ—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ summary (Channel-based)
  - `BackgroundSummaryWorker` ‚Äî —Ñ–æ–Ω–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏
  - –ö–æ–º–∞–Ω–¥–∞ `/summary` —Ç–µ–ø–µ—Ä—å —Å—Ä–∞–∑—É –æ—Ç–≤–µ—á–∞–µ—Ç "–ì–µ–Ω–µ—Ä–∏—Ä—É—é –≤—ã–∂–∏–º–∫—É..." –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –≤ —Ñ–æ–Ω–µ
  - –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É nginx timeout 60 —Å–µ–∫ ‚Äî summary –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å 30-120 —Å–µ–∫

### Changed
- **Disabled Rerank in /ask** ‚Äî –æ—Ç–∫–ª—é—á—ë–Ω LLM-–ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
  - –≠–∫–æ–Ω–æ–º–∏—è 5-7 —Å–µ–∫—É–Ω–¥ –∏ ~1300 —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –∑–∞–ø—Ä–æ—Å
  - RAG Fusion + RRF –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ö–æ—Ä–æ—à–µ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
  - LLM –Ω–∞ Stage 1/2 —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- **Removed ILIKE fallback** ‚Äî —É–±—Ä–∞–Ω —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –∏–∑ RAG Fusion:
  - ILIKE –¥–æ–±–∞–≤–ª—è–ª 1-2 —Å–µ–∫—É–Ω–¥—ã (4 –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞)
  - –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π score 0.95 –ª–æ–º–∞–ª —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ
  - –ü–æ—Ä–æ–≥ 3 —Å–∏–º–≤–æ–ª–∞ –ø—Ä–æ–ø—É—Å–∫–∞–ª –Ω—É–∂–Ω—ã–π —Å–ª–µ–Ω–≥ ("–ª–æ–ª", "—Ö–∞—Ö")
  - RAG Fusion –≤–∞—Ä–∏–∞—Ü–∏–∏ —É–∂–µ –≤–∫–ª—é—á–∞—é—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- **Parallel Memory + Search + ParticipantNames** ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è –≤ `/ask`:
  - Memory context, participant names –∏ RAG Fusion –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
  - –≠–∫–æ–Ω–æ–º–∏—è ~0.5 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –∑–∞–ø—Ä–æ—Å
  - `/smart` –±–æ–ª—å—à–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç memory (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è)
  - –£–¥–∞–ª—ë–Ω –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π `RerankService` –∏–∑ DI
- **Nginx timeout increased** ‚Äî —É–≤–µ–ª–∏—á–µ–Ω `proxy_read_timeout` —Å 60s –¥–æ 180s

## [2025-12-29]

- **Hybrid Profile System** ‚Äî –Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
  - `ProfileQueueService` ‚Äî –æ—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
  - `ProfileWorkerService` ‚Äî –≤–æ—Ä–∫–µ—Ä –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ñ–∞–∫—Ç–æ–≤ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
  - `ProfileGeneratorService` ‚Äî –Ω–æ—á–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–ª—É–±–æ–∫–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π (03:00 UTC)
  - –¢–∞–±–ª–∏—Ü–∞ `message_queue` ‚Äî –æ—á–µ—Ä–µ–¥—å –Ω–∞ –∞–Ω–∞–ª–∏–∑
  - –¢–∞–±–ª–∏—Ü–∞ `user_facts` ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç—ã –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
  - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `user_profiles` ‚Äî summary, communication_style, role_in_chat, roast_material
- **Enhanced Memory Context** ‚Äî —É–ª—É—á—à–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–∞–º—è—Ç–∏ –≤ `/ask`:
  - `BuildEnhancedContextAsync()` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç user_facts –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
  - –î–≤–∞ —Ä–∞–≤–Ω–æ–ø—Ä–∞–≤–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞: –ø–∞–º—è—Ç—å + RAG –∫–æ–Ω—Ç–µ–∫—Å—Ç
  - LLM –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –æ—Ç–≤–µ—Ç–∞

### Changed
- **RAG Fusion with participant context** ‚Äî —É–ª—É—á—à–µ–Ω—ã –≤–∞—Ä–∏–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:
  - –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è –∏–º–µ–Ω–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–∞—Ç–∞ –≤ LLM –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∞—Ä–∏–∞—Ü–∏–π
  - LLM –≤–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ –Ω–µ –ø—É—Ç–∞–µ—Ç –∏–º–µ–Ω–∞ —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ —Ç–µ—Ä–º–∏–Ω–∞–º–∏
  - –ü—Ä–∏–º–µ—Ä: "–±–µ–∫" —Å —É—á–∞—Å—Ç–Ω–∏–∫–æ–º "–ë–µ–∫" ‚Üí –≤–∞—Ä–∏–∞—Ü–∏–∏ –¥–ª—è –∏–º–µ–Ω–∏, –∞ –Ω–µ "backend"
- **RAG Fusion text patterns** ‚Äî LLM —Ç–µ–ø–µ—Ä—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —á–∞—Ç–∞:
  - "—Å–º–µ–µ—Ç—Å—è" ‚Üí –∞—Ö–∞—Ö–∞—Ö, —Ö–∞—Ö–∞—Ö–∞, –ª–æ–ª, )))
  - "–¥–∞" ‚Üí –∞–≥–∞, —É–≥—É, +, –æ–∫
  - –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞–ª–µ–∫–∏ –æ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- **Reranker: reorder only, no filtering** ‚Äî Reranker –±–æ–ª—å—à–µ –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
  - –†–∞–Ω—å—à–µ: score=0 ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–¥–∞–ª—è–ª—Å—è (—Ç–µ—Ä—è–ª–∏—Å—å "–•–ê–•–ê–•–ê" –∫–∞–∫ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ)
  - –¢–µ–ø–µ—Ä—å: reranker —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–µ—Ç, –¥–æ–≤–µ—Ä—è–µ–º RAG Fusion + ILIKE –¥–ª—è –ø–æ–∏—Å–∫–∞
- **AskHandler Stage 2 prompt** ‚Äî –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω –ø—Ä–æ–º–ø—Ç –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏:
  - –ü–∞–º—è—Ç—å –∏ RAG —Ç–µ–ø–µ—Ä—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∫–∞–∫ —Ä–∞–≤–Ω–æ–ø—Ä–∞–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
  - –ü—Ä–∞–≤–∏–ª–æ: "–ï—Å–ª–∏ –≤ –ø–∞–º—è—Ç–∏ –µ—Å—Ç—å –ø—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ"
  - –£–±—Ä–∞–Ω–∞ –ø—É—Ç–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É JSON-—Ñ–∞–∫—Ç–∞–º–∏ –∏ memory context

### Fixed
- **Memory facts ignored bug** ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∫–æ–≥–¥–∞ LLM –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª —Ñ–∞–∫—Ç—ã –∏–∑ –ø–∞–º—è—Ç–∏ –≤ –ø–æ–ª—å–∑—É RAG –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- **Query self-match bug** ‚Äî —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å similarity >= 0.98 (–ø–æ—á—Ç–∏ —Ç–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å –∑–∞–ø—Ä–æ—Å–æ–º)

---

## [2025-12-28]

### Changed
- **HuggingFace Embeddings** ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ —Å OpenAI –Ω–∞ HuggingFace:
  - –ù–æ–≤—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä `EmbeddingProvider.HuggingFace`
  - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ –ë–î –¥–ª—è 1024-–º–µ—Ä–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤
  - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

### Fixed
- **HuggingFace API URL** ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω URL —Å deprecated api-inference –Ω–∞ router.huggingface.co

---

## [2025-12-27]

### Changed
- **LlmMemoryService refactoring** ‚Äî —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è –ª—É—á—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å Dapper:
  - –ó–∞–º–µ–Ω–µ–Ω—ã internal records –Ω–∞ classes –¥–ª—è nullable DateTimeOffset
  - –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç

### Fixed
- **Dapper mapping bug** ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –º–∞–ø–ø–∏–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫ —Å —è–≤–Ω—ã–º–∏ –∞–ª–∏–∞—Å–∞–º–∏:
  - `chat_id AS ChatId`, `user_id AS UserId`
  - –†–µ—à–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ ChatId=0 –∏ DateUtc=MinValue

---

## [2025-12-26]

### Changed
- **AskHandler prompt refinement** ‚Äî —É—Ç–æ—á–Ω–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ–∞–∫—Ç–æ–≤:
  - –£–∂–µ—Å—Ç–æ—á–µ–Ω—ã —è–∑—ã–∫–æ–≤—ã–µ –≥–∞–π–¥–ª–∞–π–Ω—ã
  - –ê–±—Å—Ç—Ä–∞–≥–∏—Ä–æ–≤–∞–Ω—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Fixed
- **Minimum text length filter** ‚Äî —Å–Ω–∏–∂–µ–Ω –ø–æ—Ä–æ–≥ —Å 10 –¥–æ 5 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

---

## [Earlier]

### Added
- RAG Fusion search —Å RRF (Reciprocal Rank Fusion)
- Rerank Service ‚Äî LLM-based –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- Two-stage generation ‚Äî Stage 1: —Ñ–∞–∫—Ç—ã (T=0.1), Stage 2: —é–º–æ—Ä (T=0.6)
- Daily Summary Service ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–Ω–µ–≤–Ω—ã–µ —Å–∞–º–º–∞—Ä–∏
- Background Embedding Service ‚Äî —Ñ–æ–Ω–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- Chat Import ‚Äî –∏–º–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑ Telegram HTML export
- Admin Commands ‚Äî /admin stats, /admin logs, /admin chats
- Debug Service ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—á—ë—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
